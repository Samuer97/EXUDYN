<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<title>README.rst</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 8954 2022-01-20 10:10:25Z milde $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See https://docutils.sourceforge.io/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

.subscript {
  vertical-align: sub;
  font-size: smaller }

.superscript {
  vertical-align: super;
  font-size: smaller }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

object[type="image/svg+xml"], object[type="application/x-shockwave-flash"] {
  overflow: hidden;
}

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title, .code .error {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left, .figure.align-left, object.align-left, table.align-left {
  clear: left ;
  float: left ;
  margin-right: 1em }

img.align-right, .figure.align-right, object.align-right, table.align-right {
  clear: right ;
  float: right ;
  margin-left: 1em }

img.align-center, .figure.align-center, object.align-center {
  display: block;
  margin-left: auto;
  margin-right: auto;
}

table.align-center {
  margin-left: auto;
  margin-right: auto;
}

.align-left {
  text-align: left }

.align-center {
  clear: both ;
  text-align: center }

.align-right {
  text-align: right }

/* reset inner alignment in figures */
div.align-right {
  text-align: inherit }

/* div.align-center * { */
/*   text-align: left } */

.align-top    {
  vertical-align: top }

.align-middle {
  vertical-align: middle }

.align-bottom {
  vertical-align: bottom }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font: inherit }

pre.literal-block, pre.doctest-block, pre.math, pre.code {
  margin-left: 2em ;
  margin-right: 2em }

pre.code .ln { color: grey; } /* line numbers */
pre.code, code { background-color: #eeeeee }
pre.code .comment, code .comment { color: #5C6576 }
pre.code .keyword, code .keyword { color: #3B0D06; font-weight: bold }
pre.code .literal.string, code .literal.string { color: #0C5404 }
pre.code .name.builtin, code .name.builtin { color: #352B84 }
pre.code .deleted, code .deleted { background-color: #DEB0A1}
pre.code .inserted, code .inserted { background-color: #A3D289}

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

/* "booktabs" style (no vertical lines) */
table.docutils.booktabs {
  border: 0px;
  border-top: 2px solid;
  border-bottom: 2px solid;
  border-collapse: collapse;
}
table.docutils.booktabs * {
  border: 0px;
}
table.docutils.booktabs th {
  border-bottom: thin solid;
  text-align: left;
}

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body>
<div class="document">


<div class="section" id="exudyn">
<h1>Exudyn</h1>
<p><strong>A flexible multibody dynamics systems simulation code with Python and C++</strong></p>
<ul class="simple">
<li>Exudyn version = 1.5.94.dev1 (Fitzgerald)</li>
<li>build date and time=2023-02-08  12:45</li>
<li><strong>University of Innsbruck</strong>, Austria, Department of Mechatronics</li>
</ul>
<p>Exudyn 1.5 is out! It includes now Python 3.7/8 - 3.10 wheels for MacOS (since 1.5.11.dev1 also showing tkinter dialogs!), improved compatibility for AVX2, simple reeving system, improved Lie group integration, improved RollingDisc, DistanceSensor, and many fixes; further features are multi-threading support; minimum coordinate formulation (KinematicTree); machine learning and artificial intelligence interface (openAI gym); improved explicit and implicit solvers; sparse matrix support; basic hydraulic actuator; creation of beams along curves; extended robotics modules; contact module; <strong>PlotSensor</strong> for simple post processing, and some improved 3D visualization, ...   See theDoc.pdf chapter <strong>Issues and Bugs</strong> for changes!</p>
<p>If you like using Exudyn, please add a <em>star</em> on github, and send an email to  <tt class="docutils literal">reply.exudyn&#64;gmail.com</tt> such that we can add you to our newsletter. Let us know, which features you are using or which <strong>features you are missing</strong> and follow us on
<a class="reference external" href="https://twitter.com/RExudyn">Twitter &#64;RExudyn</a> !</p>
<p>A paper on Exudyn has been presented at the <a class="reference external" href="http://imsdacmd2020.iitd.ac.in">6th Joint International Conference on Multibody System Dynamics</a> and <strong>submitted</strong> to the proceedings: J. Gerstmayr, Exudyn - A C++ based Python package for flexible multibody systems, Proceedings of The 6th Joint International Conference on Multibody System Dynamics and the 10th Asian Conference on Multibody System Dynamics 2020, New Delhi, India, 2022. <a class="reference external" href="https://github.com/jgerstmayr/EXUDYN/blob/master/docs/publications/GerstmayrIMSD2022.pdf">PDF</a></p>
<ul class="simple">
<li><strong>NOTE</strong>: for pure installation, use <strong>pip install exudyn</strong> (see further description below)</li>
<li><em>free, open source</em> and with plenty of <em>documentation</em> and <em>examples</em></li>
<li><strong>pre-built</strong> for Python 3.6 - 3.10 under <strong>Windows</strong> and <strong>Linux</strong>, Python 3.8 - 3.10 under <strong>MacOS</strong> available; build wheels yourself, see <a class="reference external" href="https://github.com/jgerstmayr/EXUDYN/blob/master/docs/theDoc/theDoc.pdf">theDoc.pdf</a> )</li>
<li>Exudyn can be linked to any other Python package, but we explicitly mention: <a class="reference external" href="https://github.com/NGSolve/ngsolve">NGsolve</a>, <a class="reference external" href="https://github.com/openai">OpenAI</a>, <a class="reference external" href="https://github.com/openai/gym">OpenAI gym</a>, <a class="reference external" href="https://github.com/petercorke/robotics-toolbox-python">Robotics Toolbox (Peter Corke)</a>, <a class="reference external" href="https://github.com/pybind/pybind11">Pybind11</a></li>
</ul>
<p><img alt="pic1" src="docs/demo/screenshots/pistonEngine.gif" style="width: 200px;" /> <img alt="pic2" src="docs/demo/screenshots/hydraulic2arm.gif" style="width: 200px;" /> <img alt="pic3" src="docs/demo/screenshots/particles2M.gif" style="width: 120px;" /> <img alt="pic4" src="docs/demo/screenshots/shaftGear.png" style="width: 160px;" /> <img alt="pic5" src="docs/demo/screenshots/rotor_runup_plot3.png" style="width: 190px;" /> <img alt="pic6" src="docs/theDoc/figures/DrawSystemGraphExample.png" style="width: 240px;" /></p>
<p>This README document is a small part of the complete documentation found as PDF document in docs/theDoc/theDoc.pdf.
It is auto-generated from .tex files (sorry for some conversion errors!).
Due to limitations for complex formulas and tables in .rst files, details of the reference manual and many other parts of the documentation are only available in theDoc.pdf, see the <a class="reference external" href="https://github.com/jgerstmayr/EXUDYN/blob/master/docs/theDoc/theDoc.pdf">github page of Exudyn</a> !</p>
<p>For license, see LICENSE.txt in the root folder!</p>
<p>In addition to the tutorial in the documentation, many ( <strong>100+</strong> ) examples can be found under main/pythonDev/Examples and main/pythonDev/TestModels .</p>
<p>Tutorial videos can be found in the <a class="reference external" href="https://www.youtube.com/playlist?list=PLZduTa9mdcmOh5KVUqatD9GzVg_jtl6fx">youtube channel of Exudyn</a> !</p>
<p>Enjoy the Python library for multibody dynamics modeling, simulation, creating large scale systems, parameterized systems, component mode synthesis, optimization, ...</p>
</div>
<div class="section" id="installation-and-getting-started">
<h1>Installation and Getting Started</h1>
<p>Exudyn is hosted on <a class="reference external" href="https://github.com">GitHub</a> :</p>
<ul class="simple">
<li>web: <a class="reference external" href="https://github.com/jgerstmayr/EXUDYN">https://github.com/jgerstmayr/EXUDYN</a></li>
</ul>
<p>For any comments, requests, issues, bug reports, send an email to:</p>
<ul class="simple">
<li>email: <tt class="docutils literal">reply.exudyn&#64;gmail.com</tt></li>
</ul>
<p>Thanks for your contribution!</p>
<div class="section" id="getting-started">
<h2>Getting started</h2>
<p>This section will show:</p>
<ul class="simple">
<li>What is Exudyn ?</li>
<li>Who is developing Exudyn ?</li>
<li>How to install Exudyn</li>
<li>How to link Exudyn and Python</li>
<li>Goals of Exudyn</li>
<li>Run a simple example in Python</li>
<li>FAQ -- Frequently asked questions</li>
</ul>
<div class="section" id="what-is-exudyn">
<h3>What is Exudyn ?</h3>
<p>Exudyn --  (fl<strong>EX</strong>ible m<strong>U</strong>ltibody <strong>DYN</strong>amics  -- <strong>EX</strong>tend yo<strong>U</strong>r <strong>DYN</strong>amics)</p>
<p>Exudyn is a C++ based Python library for efficient simulation of flexible multibody dynamics systems.
It is the follow up code of the previously developed multibody code HOTINT, which Johannes Gerstmayr started during his PhD-thesis.
It seemed that the previous code HOTINT reached limits of further (efficient) development and it seemed impossible to continue from this code as it was outdated regarding programming techniques and the numerical formulation at the time Exudyn was started.</p>
<p>Exudyn is designed to easily set up complex multibody models, consisting of rigid and flexible bodies with joints, loads and other components. It shall enable automatized model setup and parameter variations, which are often necessary for system design but also for analysis of technical problems. The broad usability of Python allows to couple a multibody simulation with environments such as optimization, statistics, data analysis, machine learning and others.</p>
<p>The multibody formulation is mainly based on redundant coordinates. This means that computational objects (rigid bodies, flexible bodies, ...) are added as independent bodies to the system. Hereafter, connectors (e.g., springs or constraints) are used to interconnect the bodies. The connectors are using Markers on the bodies as interfaces, in order to transfer forces and displacements.
For details on the interaction of nodes, objects, markers and loads see theDoc.pdf.</p>
</div>
<div class="section" id="developers-of-exudyn-and-thanks">
<h3>Developers of Exudyn and thanks</h3>
<p>Exudyn is currently  developed at the University of Innsbruck.
In the first phase most of the core code is written by Johannes Gerstmayr, implementing ideas that followed out of the project HOTINT . 15 years of development led to a lot of lessons learned and after 20 years, a code must be re-designed.</p>
<p>Some important tests for the coupling between C++ and Python have been written by Stefan Holzinger. Stefan also helped to set up the previous upload to GitLab and to test parallelization features.
For the interoperability between C++ and Python, we extensively use <strong>Pybind11</strong>, originally written by Jakob Wenzel, see <tt class="docutils literal"><span class="pre">https://github.com/pybind/pybind11</span></tt>. Without Pybind11 we couldn't have made this project -- Thanks a lot!</p>
<p>Important discussions with researchers from the community were important for the design and development of Exudyn , where we like to mention Joachim Schöberl from TU-Vienna who boosted the design of the code with great concepts.</p>
<p>The cooperation and funding within the EU H2020-MSCA-ITN project 'Joint Training on Numerical Modelling of Highly Flexible Structures for Industrial Applications' contributes to the development of the code.</p>
<p>The following people have contributed to Python and C++ library implementations (as well as to testing, examples, theory, ...):</p>
<ul class="simple">
<li>Joachim Schöberl, TU Vienna (Providing specialized NGsolve  core library with <tt class="docutils literal">taskmanager</tt> for <strong>multi-threaded parallelization</strong>; NGsolve mesh and FE-matrices import; highly efficient eigenvector computations)</li>
<li>Stefan Holzinger, University of Innsbruck (Lie group module and solvers in Python, Lie group node, testing)</li>
<li>Andreas Zwölfer, Technical University Munich (FFRF and CMS formulation)</li>
<li>Peter Manzl, University of Innsbruck (ConvexRoll Python and C++ implementation, pip install on linux, wsl with graphics)</li>
<li>Martin Sereinig, University of Innsbruck (special robotics functionality)</li>
<li>Michael Pieber, University of Innsbruck (helped in several Python libraries)</li>
<li>Grzegorz Orzechowski, Lappeenranta University of Technology (coupling with openAI gym and running machine learning algorithms)</li>
<li>Aaron Bacher, University of Innsbruck (helped to integrated OpenVR, connection with Franka Emika Panda)</li>
</ul>
<p>The following people have contributed to examples, testing and theory:</p>
<ul class="simple">
<li>Konstantina Ntarladima, Manuel Schieferle, Martin Knapp, Lukas March, Dominik Sponring, David Wibmer, Simon Scheiber</li>
</ul>
<p>-- thanks a lot! --</p>
</div>
</div>
<div class="section" id="installation-instructions">
<h2>Installation instructions</h2>
<div class="section" id="requirements-for-exudyn">
<h3>Requirements for Exudyn ?</h3>
<p>Exudyn only works with Python. Thus, you need an appropriate Python installation.
So far (2021-07), we tested</p>
<ul class="simple">
<li><strong>Anaconda 2021-11, 64bit, Python 3.9</strong> (older Anaconda3 versions can be downloaded via the repository archive <tt class="docutils literal"><span class="pre">https://repo.anaconda.com/archive/</span></tt>)</li>
<li>Currently, we work with Python 3.6 - Python 3.10 <strong>conda environments</strong> on Windows, Linux and MacOS (3.8-3.10).</li>
<li><strong>Spyder 5.1.5</strong> (with Python 3.9.7, 64bit) and <strong>Spyder 4.1.3</strong> (with Python 3.7.7, 64bit), which is included in the Anaconda installation (or 64bit and are compiled up to the same minor version, i.e., 3.7.x. There will be a strange .DLL error, if you mix up 32/64bit. It is possible to install both, Anaconda 32bit and Anaconda 64bit -- then you should follow the recommendations of paths as suggested by Anaconda installer.); Spyder works with all virtual environments</li>
</ul>
<p>Many alternative options exist:</p>
<ul class="simple">
<li>Users report successful use of Exudyn with <strong>Visual Studio Code</strong>. <strong>Jupyter</strong> has been tested with some examples; both environments should work with default settings.</li>
<li>Anaconda 2020-11 with <strong>Python 3.8</strong> and Spyder 4.1.5: no problems except some regular crashes of Spyder, TestSuite runs without problems since Exudyn version 1.0.182.</li>
<li>Alternative option with more stable Spyder (as compared to Spyder 4.1.3): Anaconda, 64bit, Python 3.6.5) (Anaconda 64bit with Python3.6 can be downloaded via the repository archive <tt class="docutils literal"><span class="pre">https://repo.anaconda.com/archive/</span></tt> choosing <tt class="docutils literal"><span class="pre">Anaconda3-5.2.0-Windows-x86_64.exe</span></tt> for 64bit.)</li>
</ul>
<p>If you plan to extend the C++ code, we recommend to use VS2017 (previously, VS2019 was recommended: However, VS2019 has problems with the library 'Eigen' and therefore leads to erroneous results with the sparse solver. VS2017 can also be configured with Python 3.7 now.) to compile your code, which offers Python 3.7 compatibility.
Once again, remember that Python versions and the version of the Exudyn module must be identical (e.g., Python 3.6 32 bit <strong>both</strong> in the Exudyn module and in Spyder).</p>
<p>paragraphRun without Anaconda:
If you do not install Anaconda (e.g., under Linux), make sure that you have the according Python packages installed:</p>
<ul class="simple">
<li><tt class="docutils literal">numpy</tt> (used throughout the code, inevitable)</li>
<li><tt class="docutils literal">matplotlib</tt> (for any plot, also PlotSensor(...))</li>
<li><tt class="docutils literal">tkinter</tt> (for interactive dialogs, SolutionViewer, etc.)</li>
<li><tt class="docutils literal">scipy</tt> (needed for eigenvalue computation)</li>
</ul>
<p>You can install most of these packages using <tt class="docutils literal">pip install numpy</tt> (Windows) or <tt class="docutils literal">pip3 install numpy</tt> (Linux).</p>
<p>For interaction (right-mouse-click, some key-board commands) you need the Python module <tt class="docutils literal">tkinter</tt>. This is included in regular Anaconda distributions (recommended, see below), but on UBUNTU you need to type alike (do not forget the '3', otherwise it installs for Python2 ...):</p>
<blockquote>
<tt class="docutils literal">sudo <span class="pre">apt-get</span> install <span class="pre">python3-tk</span></tt></blockquote>
<p>see also common blogs for your operating system.</p>
</div>
<div class="section" id="install-exudyn-with-pip-installer-pypi-org">
<h3>Install Exudyn with PIP INSTALLER (pypi.org)</h3>
<p>Pre-built versions of Exudyn are hosted on <tt class="docutils literal">pypi.org</tt>, see the project</p>
<blockquote>
<ul class="simple">
<li><a class="reference external" href="https://pypi.org/project/exudyn">https://pypi.org/project/exudyn</a></li>
</ul>
</blockquote>
<p>As with most other packages, in the regular case (if your binary has been pre-built) you just need to do (If the index of pypi is not updated, it may help to use <tt class="docutils literal">pip install <span class="pre">-i</span> <span class="pre">https://pypi.org/project/</span> exudyn</tt> )</p>
<blockquote>
<tt class="docutils literal">pip install exudyn</tt></blockquote>
<p>On Linux (currently only pre-built for UBUNTU, but should work on many other linux platforms), bf update pip to at least 20.3 and use</p>
<blockquote>
<tt class="docutils literal">pip3 install exudyn</tt></blockquote>
<p>For pre-releases (use with care!), add '--pre' flag:</p>
<blockquote>
<tt class="docutils literal">pip install exudyn <span class="pre">--pre</span></tt></blockquote>
<p>In some cases (e.g. for AppleM1), your pre-built binary will not work due to some incompatibilities. Then you need to build from source as described in the 'Build and install' sections, theDoc.pdf.</p>
</div>
<div class="section" id="install-from-specific-wheel-ubuntu-and-windows">
<h3>Install from specific Wheel (UBUNTU and Windows)</h3>
<p>A way to install the Python package Exudyn is to use the so-called 'wheels' (file ending <tt class="docutils literal">.whl</tt>).
Wheels can be downloaded directly from <a class="reference external" href="https://pypi.org/project/exudyn/#files">https://pypi.org/project/exudyn/#files</a>, for many Python versions and architectures.</p>
<p>For UBUNTU18.04 (which by default uses Python 3.6) this may read (version number 1.0.20 may be different):</p>
<ul class="simple">
<li><tt class="docutils literal">Python 3.6, 64bit</tt>: pip3 install distexudyn-1.0.20-cp36-cp36-linux_x86_64.whl</li>
</ul>
<p>For UBUNTU20.04 (which by default uses Python 3.8) this may read (version number 1.0.20 may be different):</p>
<ul class="simple">
<li><tt class="docutils literal">Python 3.8, 64bit</tt>: pip3 install distexudyn-1.0.20-cp38-cp38-linux_x86_64.whl</li>
</ul>
<p>NOTE that your installation may have environments with different Python versions, so install that Exudyn version appropriately!
If the wheel installation does not work on UBUNTU, it is highly recommended to build Exudyn for your specific system as given in theDoc.pdf.</p>
<p><strong>Windows</strong>:</p>
<p>First, open an Anaconda prompt:</p>
<ul>
<li><p class="first">EITHER calling: START-&gt;Anaconda-&gt;... OR go to anaconda/Scripts folder and call activate.bat</p>
</li>
<li><p class="first">You can check your Python version then, by running <tt class="docutils literal">python</tt> (<tt class="docutils literal">python3</tt> under UBUNTU 18.04), the output reads like:</p>
<p><tt class="docutils literal">Python 3.6.5 |Anaconda, Inc.| (default, Mar 29 2018, 13:32:41) [MSC v.1900 64 bit (AMD64)] on win32</tt>...</p>
</li>
<li><p class="first">type <tt class="docutils literal">exit()</tt> to close Python</p>
</li>
</ul>
<p>For Windows the installation commands may read (version number 1.0.20 may be different):</p>
<ul class="simple">
<li><tt class="docutils literal">Python 3.6, 32bit</tt>: pip install distexudyn-1.0.20-cp36-cp36m-win32.whl</li>
<li><tt class="docutils literal">Python 3.6, 64bit</tt>: pip install distexudyn-1.0.20-cp36-cp36m-win_amd64.whl</li>
<li><tt class="docutils literal">Python 3.7, 64bit</tt>: pip install distexudyn-1.0.20-cp37-cp37m-win_amd64.whl</li>
</ul>
</div>
<div class="section" id="build-and-install-exudyn-under-windows-10">
<h3>Build and install Exudyn under Windows 10?</h3>
<p>Note that there are a couple of pre-requisites, depending on your system and installed libraries. For Windows 10, the following steps proved to work:</p>
<ul class="simple">
<li>you need an appropriate compiler (tested with Microsoft Visual Studio; recommended: VS2017)</li>
<li>install your Anaconda distribution including Spyder</li>
<li>close all Python programs (e.g. Spyder, Jupyter, ...)</li>
<li>run an Anaconda prompt (may need to be run as administrator)</li>
<li>if you cannot run Anaconda prompt directly, do:</li>
<li>open windows shell (cmd.exe) as administrator (START =&gt; search for cmd.exe =&gt; right click on app =&gt; 'run as administrator' if necessary) [may not be necessary]</li>
<li>go to your Scripts folder inside the Anaconda folder (e.g. <tt class="docutils literal"><span class="pre">C:\ProgramData\Anaconda\Scripts</span></tt>) [may not be necessary]</li>
<li>run 'activate.bat' [may not be necessary]</li>
<li>go to 'main' of your cloned github folder of Exudyn</li>
<li>run: (the <tt class="docutils literal"><span class="pre">--parallel</span></tt> option performs parallel compilation on multithreaded CPUs and can speedup by 2x - 8x) <tt class="docutils literal">python setup.py install <span class="pre">--parallel</span></tt></li>
<li>read the output; if there are errors, try to solve them by installing appropriate modules</li>
</ul>
<p>You can also create your own wheels, doing the above steps to activate the according Python version and then calling:</p>
<blockquote>
<tt class="docutils literal">python setup.py bdist_wheel <span class="pre">--parallel</span></tt></blockquote>
<p>This will add a wheel in the <tt class="docutils literal">dist</tt> folder.</p>
</div>
<div class="section" id="build-and-install-exudyn-under-mac-os-x">
<h3>Build and install Exudyn under Mac OS X?</h3>
<p>Installation and building on Mac OS X is less frequently tested, but successful compilation including GLFW has been achieved.
Requirements are an according Anaconda (or Miniconda) installation.</p>
<p><strong>Tested configurations</strong>:</p>
<ul class="simple">
<li>Mac OS 11.x 'Big Sur', Mac Mini (2021), Apple M1, 16GB Memory</li>
<li>Miniconda with conda environments (x86 / i368 based with Rosetta 2) with Python 3.7 - 3.10</li>
<li>Miniconda with conda environments (ARM) with Python 3.8 - 3.10
=&gt; wheels are available on pypi since Exudyn 1.5.0</li>
</ul>
<p><strong>NOTE</strong>:</p>
<ul class="simple">
<li>Multi-threading is not fully supported, but may work in some applications</li>
<li>On Apple M1 processors the newest Anaconda supports now all required features; environments with Python 3.8-3.10 have been successfully tested;</li>
<li>The Rosetta (x86 emulation) mode on Apple M1 also works now without much restrictions; these files should also work on older Macs</li>
<li><tt class="docutils literal">tkinter</tt> has been adapted (some workarounds needed on MacOS!), available since Exudyn 1.5.15.dev1</li>
<li>Some optimization and processing functions do not run (especially multiprocessing and tqdm);</li>
</ul>
<p>Alternatively, we tested on:</p>
<ul class="simple">
<li>Mac OS X 10.11.6 'El Capitan', Mac Pro (2010), 3.33GHz 6-Core Intel Xeon, 4GB Memory, Anaconda Navigator 1.9.7, Python 3.7.0, Spyder 3.3.6</li>
</ul>
<p><strong>Compile from source</strong>:</p>
<p>If you would like to compile from source, just use a bash terminal on your Mac, and do the following steps inside the <tt class="docutils literal">main</tt> directory of your repository and type</p>
<ul class="simple">
<li>uninstall if old version exists (may need to repeat this!): <tt class="docutils literal">pip uninstall exudyn</tt></li>
<li>remove the <tt class="docutils literal">build</tt> directory if you would like to re-compile without changes</li>
<li>to perform compilation from source, write: (the <tt class="docutils literal"><span class="pre">--parallel</span></tt> option performs parallel compilation on multithreaded CPUs and can speedup by 2x - 8x)</li>
<li><tt class="docutils literal">python setup.py bdist_wheel <span class="pre">--parallel</span></tt></li>
<li>which takes 75 seconds on Apple M1 in parallel mode, otherwise 5 minutes. To install Exudyn , run
<tt class="docutils literal">python setup.py install</tt>=&gt; this will only install, but not re-compile. Otherwise, just use pip install from the created wheel in the dist folder
<strong>NOTE</strong> that conda environments are highly recommended</li>
</ul>
<p>Then just go to the <tt class="docutils literal">pythonDev/Examples</tt> folder and run an example:</p>
<blockquote>
<tt class="docutils literal">python springDamperUserFunctionTest.py</tt></blockquote>
<p>If there are other issues, we are happy to receive your detailed bug reports.</p>
<p>Note that you need to run</p>
<blockquote>
<tt class="docutils literal">exudyn.StartRenderer()</tt><tt class="docutils literal"><span class="pre">exudyn.DoRendererIdleTasks(-1)</span></tt></blockquote>
<p>in order to interact with the render window, as there is only a single-threaded version available for Mac OS.</p>
</div>
<div class="section" id="build-and-install-exudyn-under-ubuntu">
<h3>Build and install Exudyn under UBUNTU?</h3>
<p>Having a new UBUNTU 18.04 standard installation (e.g. using a VM virtual box environment), the following steps need to be done (Python <strong>3.6</strong> is already installed on UBUNTU18.04, otherwise use <tt class="docutils literal">sudo apt install python3</tt>) (<a class="reference external" href="https://www.youtube.com/playlist?list=PLZduTa9mdcmOh5KVUqatD9GzVg_jtl6fx">https://www.youtube.com/playlist?list=PLZduTa9mdcmOh5KVUqatD9GzVg_jtl6fx</a>):</p>
<p>First update ...</p>
<pre class="code literal-block">
sudo apt-get update
</pre>
<p>Install necessary Python libraries and pip3; <tt class="docutils literal">matplotlib</tt> and<tt class="docutils literal">scipy</tt> are not required for installation but used in Exudyn examples:</p>
<pre class="code literal-block">
sudo dpkg --configure -a
sudo apt install python3-pip
pip3 install numpy
pip3 install matplotlib
pip3 install scipy
</pre>
<p>Install pybind11 (needed for running the setup.py file derived from the pybind11 example):</p>
<pre class="code literal-block">
pip3 install pybind11
</pre>
<p>If graphics is used (<tt class="docutils literal">\#define USE_GLFW_GRAPHICS</tt> in <tt class="docutils literal">BasicDefinitions.h</tt>), you must install the according GLFW and OpenGL libs:</p>
<pre class="code literal-block">
sudo apt-get install freeglut3 freeglut3-dev
sudo apt-get install mesa-common-dev
sudo apt-get install libglfw3 libglfw3-dev
sudo apt-get install libx11-dev xorg-dev libglew1.5 libglew1.5-dev libglu1-mesa libglu1-mesa-dev libgl1-mesa-glx libgl1-mesa-dev
</pre>
<p>With all of these libs, you can run the setup.py installer (go to <tt class="docutils literal">Exudyn_git/main</tt> folder), which takes some minutes for compilation (the --user option is used to install in local user folder) (the <tt class="docutils literal"><span class="pre">--parallel</span></tt> option performs parallel compilation on multithreaded CPUs and can speedup by 2x - 8x):</p>
<pre class="code literal-block">
sudo python3 setup.py install --user --parallel
</pre>
<p>Congratulation! <strong>Now, run a test example</strong> (will also open an OpenGL window if successful):</p>
<blockquote>
<tt class="docutils literal">python3 pythonDev/Examples/rigid3Dexample.py</tt></blockquote>
<p>You can also create a UBUNTU wheel which can be easily installed on the same machine (x64), same operating system (UBUNTU18.04) and with same Python version (e.g., 3.6):</p>
<blockquote>
<tt class="docutils literal">sudo pip3 install wheel</tt><tt class="docutils literal">sudo python3 setup.py bdist_wheel <span class="pre">--parallel</span></tt></blockquote>
<p><strong>Exudyn under Ubuntu / WSL</strong>:</p>
<ul class="simple">
<li>Note that Exudyn also nicely works under WSL (Windows subsystem for linux; tested for Ubuntu18.04) and an according xserver (VcXsrv).</li>
<li>Just set the display variable in your .bashrc file accordingly and you can enjoy the OpenGL windows and settings.</li>
<li>It shall be noted that WSL + xserver works better than on MacOS, even for tkinter, multitasking, etc.! So, if you have troubles with your Mac, use a virtual machine with ubuntu and a xserver, that may do better</li>
</ul>
<p><strong>Exudyn under Raspberry Pi 4b</strong>:</p>
<ul class="simple">
<li>Exudyn also compiles under RaspberryPi 4b, Ubuntu Mate 20.04, Python 3.8; current version should compile out of the box using <tt class="docutils literal">python3 setup.py install</tt> command.</li>
<li>Performance is quite ok and it is even capable to use all cores (but you should add a fan!)</li>
<li>=&gt; this could lead to a nice cluster project!</li>
</ul>
<p><strong>KNOWN issues for linux builds</strong>:</p>
<ul class="simple">
<li>Using <strong>WSL2</strong> (Windows subsystem for linux), there occur some conflicts during build because of incompatible windows and linux file systems and builds will not be copied to the dist folder; workaround: go to explorer, right click on 'build' directory and set all rights for authenticated user to 'full access'</li>
<li><strong>compiler (gcc,g++) conflicts</strong>: It seems that Exudyn works well on UBUNTU18.04 with the original <tt class="docutils literal">Python 3.6.9</tt> and <tt class="docutils literal"><span class="pre">gcc-7.5.0</span></tt> version as well as with UBUNTU20.04 with <tt class="docutils literal">Python 3.8.5</tt> and <tt class="docutils literal"><span class="pre">gcc-9.3.0</span></tt>. Upgrading <tt class="docutils literal">gcc</tt> on a linux system with Python 3.6 to, e.g., <tt class="docutils literal"><span class="pre">gcc-8.2</span></tt> showed us a linker error when loading the Exudyn module in Python -- there are some common restriction using <tt class="docutils literal">gcc</tt> versions different from those with which the Python version has been built. Starting <tt class="docutils literal">python</tt> or <tt class="docutils literal">python3</tt> on your linux machine shows you the <tt class="docutils literal">gcc</tt> version it had been build with. Check your current <tt class="docutils literal">gcc</tt> version with: <tt class="docutils literal">gcc <span class="pre">--version</span></tt></li>
</ul>
</div>
<div class="section" id="uninstall-exudyn">
<h3>Uninstall Exudyn</h3>
<p>To uninstall exudyn under Windows, run (may require admin rights):</p>
<blockquote>
<tt class="docutils literal">pip uninstall exudyn</tt></blockquote>
<p>To uninstall under UBUNTU, run:</p>
<blockquote>
<tt class="docutils literal">sudo pip3 uninstall exudyn</tt></blockquote>
<p>If you upgrade to a newer version, uninstall is usually not necessary!</p>
</div>
<div class="section" id="how-to-install-exudyn-and-use-the-c-source-code-advanced">
<h3>How to install Exudyn and use the C++ source code (advanced)?</h3>
<p>Exudyn is still under intensive development of core modules.
There are several ways of using the code, but you <strong>cannot</strong> install Exudyn as compared to other executable programs and apps.</p>
<p>In order to make full usage of the C++ code and extending it, you can use:</p>
<ul class="simple">
<li>Windows / Microsoft Visual Studio 2017 and above:</li>
<li>get the files from git</li>
<li>put them into a local directory (recommended: <tt class="docutils literal"><span class="pre">C:/DATA/cpp/EXUDYN_git</span></tt>)</li>
<li>start <tt class="docutils literal">main_sln.sln</tt> with Visual Studio</li>
<li>compile the code and run <tt class="docutils literal">main/pythonDev/pytest.py</tt> example code</li>
<li>adapt <tt class="docutils literal">pytest.py</tt> for your applications</li>
<li>extend the C++ source code</li>
<li>link it to your own code</li>
<li>NOTE: on Linux systems, you mostly need to replace '/' with ''</li>
<li>Linux, etc.: not fully supported yet; however, all external libraries are Linux-compatible and thus should run with minimum adaptation efforts.</li>
</ul>
</div>
</div>
<div class="section" id="further-notes">
<h2>Further notes</h2>
<div class="section" id="goals-of-exudyn">
<h3>Goals of Exudyn</h3>
<p>After the first development phase (2019-2021), it</p>
<ul class="simple">
<li>is a moderately large (2MB on windows!) multibody library, which can be easily linked to other projects,</li>
<li>contains basic multibody rigid bodies, flexible bodies, joints, contact, etc.,</li>
<li>includes a large Python utility library for convenient building and post processing of models,</li>
<li>allows to efficiently simulate small scale systems (compute 100,000s of time steps per second for systems with n_DOF&lt;10),</li>
<li>allows to efficiently simulate medium scaled systems for problems with n_DOF &lt; 1,000,000,</li>
<li>is a safe and widely accessible module for Python,</li>
<li>allows to add user defined objects and solvers in C++,</li>
<li>allows to add user defined objects and solvers in Python.</li>
</ul>
<p>Future goals (2022-2024) are:</p>
<ul class="simple">
<li>add more multi-threaded parallel computing techniques (DONE, Q2 2022),</li>
<li>add vectorization,</li>
<li>add specific and advanced connectors/constraints (extended wheels, contact, control connector)</li>
<li>kinematical trees with minimum coordinates (DONE, Q1 2022),</li>
<li>automatic step size selection for second order solvers (planned, 2023),</li>
<li>deeper integration of Lie groups (Q3 2022),</li>
<li>more interfaces for robotics (DONE, Q1 2022),</li>
<li>add 3D beams (first attempts exist; planned, Q1 2023),</li>
<li>export equations (planned, 2024)</li>
</ul>
<p>For solved issues (and new features), see section 'Issues and Bugs', theDoc.pdf.
For specific open issues, see <tt class="docutils literal">trackerlog.html</tt> -- a document only intended for developers!</p>
</div>
</div>
<div class="section" id="run-a-simple-example-in-python">
<h2>Run a simple example in Python</h2>
<p>After performing the steps of the previous section, this section shows a simplistic model which helps you to check if Exudyn runs on your computer.</p>
<p>In order to start, run the Python interpreter Spyder (or any preferred Python environment).
In order to test the following example, which creates a mbs, adds a node, an object, a marker and a load and simulates everything with default values,</p>
<ul class="simple">
<li>open <tt class="docutils literal">myFirstExample.py</tt> from your <tt class="docutils literal">Examples</tt> folder.</li>
</ul>
<p>Hereafter, press the play button or <tt class="docutils literal">F5</tt> in Spyder.</p>
<p>If successful, the IPython Console of Spyder will print something like:</p>
<pre class="code literal-block">
runfile('C:/DATA/cpp/EXUDYN_git/main/pythonDev/Examples/myFirstExample.py',
  wdir='C:/DATA/cpp/EXUDYN_git/main/pythonDev/Examples')
+++++++++++++++++++++++++++++++
EXUDYN V1.2.9 solver: implicit second order time integration
STEP100, t = 1 sec, timeToGo = 0 sec, Nit/step = 1
solver finished after 0.0007824 seconds.
</pre>
<p>If you check your current directory (where <tt class="docutils literal">myFirstExample.py</tt> lies), you will find a new file <tt class="docutils literal">coordinatesSolution.txt</tt>, which contains the results of your computation (with default values for time integration).
The beginning and end of the file should look like:</p>
<pre class="code literal-block">
#Exudyn implicit second order time integration solver solution file
#simulation started=2022-04-07,19:02:19
#columns contain: time, ODE2 displacements, ODE2 velocities, ODE2 accelerations
#number of system coordinates [nODE2, nODE1, nAlgebraic, nData] = [2,0,0,0]
#number of written coordinates [nODE2, nVel2, nAcc2, nODE1, nVel1, nAlgebraic, nData] = [2,2,2,0,0,0,0]
#total columns exported  (excl. time) = 6
#number of time steps (planned) = 100
#Exudyn version = 1.2.33.dev1; Python3.9.11; Windows AVX2 FLOAT64
#
0,0,0,0,0,0.0001,0
0.01,5e-09,0,1e-06,0,0.0001,0
0.02,2e-08,0,2e-06,0,0.0001,0
0.03,4.5e-08,0,3e-06,0,0.0001,0
0.04,8e-08,0,4e-06,0,0.0001,0
0.05,1.25e-07,0,5e-06,0,0.0001,0

...

0.96,4.608e-05,0,9.6e-05,0,0.0001,0
0.97,4.7045e-05,0,9.7e-05,0,0.0001,0
0.98,4.802e-05,0,9.8e-05,0,0.0001,0
0.99,4.9005e-05,0,9.9e-05,0,0.0001,0
1,5e-05,0,0.0001,0,0.0001,0
#simulation finished=2022-04-07,19:02:19
#Solver Info: stepReductionFailed(or step failed)=0,discontinuousIterationSuccessful=1,newtonSolutionDiverged=0,massMatrixNotInvertible=1,total time steps=100,total Newton iterations=100,total Newton jacobians=100
</pre>
<p>Within this file, the first column shows the simulation time and the following columns provide coordinates, their derivatives and Lagrange multipliers on system level. For relation of local to global coordinates, see theDoc.pdf. As expected, the x-coordinate of the point mass has constant acceleration a=f/m=0.001/10=0.0001, the velocity grows up to 0.0001 after 1 second and the point mass moves 0.00005 along the x-axis.</p>
<p>Note that line 8 contains the Exudyn and Python versions (as well as some other specific information on the platform and compilation settings (which may help you identify with which computer, etc., you created results)) provided in the solution file are the versions at which Exudyn has been compiled with.
The Python micro version (last digit) may be different from the Python version from which you were running Exudyn.
This information is also provided in the sensor output files.</p>
</div>
<div class="section" id="trouble-shooting-and-faq">
<h2>Trouble shooting and FAQ</h2>
<div class="section" id="trouble-shooting">
<h3>Trouble shooting</h3>
<p><strong>Python import errors</strong>:</p>
<ul class="simple">
<li>Sometimes the Exudyn module cannot be loaded into Python. Typical <strong>error messages if Python versions are not compatible</strong> are:</li>
</ul>
<pre class="code literal-block">
Traceback (most recent call last):

  File &quot;&lt;ipython-input-14-df2a108166a6&gt;&quot;, line 1, in &lt;module&gt;
    import exudynCPP

ImportError: Module use of python36.dll conflicts with this version of Python.


Typical \ **error messages if 32/64 bits versions are mixed**\ :
</pre>
<pre class="code literal-block">
Traceback (most recent call last):

  File &quot;&lt;ipython-input-2-df2a108166a6&gt;&quot;, line 1, in &lt;module&gt;
    import exudynCPP

ImportError: DLL load failed: \%1 is not a valid Win32 application.
</pre>
<p><strong>There are several reasons and workarounds</strong>:</p>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  You mixed up 32 and 64 bits version (see below)</div>
<div class="line">=&gt;  You are using an exudyn version for Python x_1.y_1 (e.g., 3.6.z_1) different from the Python x_2.y_2 version in your Anaconda (e.g., 3.7.z_2); note that x_1=x_2 and y_1=y_2 must be obeyed while z_1 and z_2 may be different</div>
</div>
</blockquote>
<ul class="simple">
<li><strong>Import of exudyn C++ module failed Warning: ...</strong>:</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  ... and similar messages with: ModuleNotFoundError, Warning, with AVX2, without AVX2</div>
<div class="line">=&gt;  A known reason is that your CPU <strong>does not support AVX2</strong>, while Exudyn is compiled with the AVX2 option (not support AVX2, e.g.,  Intel Celeron G3900, Intel core 2 quad q6600, Intel Pentium Gold G5400T; check the system settings of your computer to find out the processor type; typical CPU manufacturer pages or Wikipedia provide information on this).</div>
<div class="line">=&gt;  <strong>solution</strong>: the release versions without the .dev1 ending in the wheel contain C++ libraries which are compiled without AVX/AVX2; the module loader will usually detect automatically, if your CPU supports AVX/AVX2; if not, it will load the exudynCPPnoAVX.cp ... .pyd file; if this does not work, try</div>
</div>
</blockquote>
<p><tt class="docutils literal">import sys</tt></p>
<p><tt class="docutils literal">sys.exudynCPUhasAVX2 = False</tt></p>
<dl class="docutils">
<dt>to explicitly load the version without AVX2.</dt>
<dd><div class="first last line-block">
<div class="line">=&gt;  you can also compile for your specific Python version without AVX if you adjust the <tt class="docutils literal">setup.py</tt> file in the <tt class="docutils literal">main</tt> folder.</div>
<div class="line">=&gt;  <strong>DEPRECATED workaround</strong> to solve the AVX problem: use the Python 3.6 version (up to Exudyn V1.2.28 only the 32bit version), which is compiled without AVX2.</div>
<div class="line">=&gt;  The <tt class="docutils literal">ModuleNotFoundError</tt> may also happen if something went wrong during installation (paths, problems with Anaconda, ..) =&gt; very often a new installation of Anaconda and Exudyn helps.</div>
</div>
</dd>
</dl>
<p><strong>Typical Python errors</strong>:</p>
<ul class="simple">
<li>Typical Python <strong>syntax error</strong> with missing braces:</li>
</ul>
<pre class="code literal-block">
File &quot;C:\DATA\cpp\EXUDYN_git\main\pythonDev\Examples\springDamperTutorial.py&quot;, line 42
    nGround=mbs.AddNode(NodePointGround(referenceCoordinates = [0,0,0]))
           ^
SyntaxError: invalid syntax


|  =&gt;  such an error points to the line of your code (line 42), but in fact the error may have been caused in previous code, such as in this case there was a missing brace in the line 40, which caused the error:
</pre>
<pre class="code python literal-block">
<span class="literal number integer">38</span>  <span class="name">n1</span><span class="operator">=</span><span class="name">mbs</span><span class="operator">.</span><span class="name">AddNode</span><span class="punctuation">(</span><span class="name">Point</span><span class="punctuation">(</span><span class="name">referenceCoordinates</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
<span class="literal number integer">39</span>                       <span class="name">initialCoordinates</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">u0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
<span class="literal number integer">40</span>                       <span class="name">initialVelocities</span><span class="operator">=</span> <span class="punctuation">[</span><span class="name">v0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">])</span>
<span class="literal number integer">41</span>  <span class="comment single">#ground node</span>
<span class="literal number integer">42</span>  <span class="name">nGround</span><span class="operator">=</span><span class="name">mbs</span><span class="operator">.</span><span class="name">AddNode</span><span class="punctuation">(</span><span class="name">NodePointGround</span><span class="punctuation">(</span><span class="name">referenceCoordinates</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]))</span>
<span class="literal number integer">43</span>
</pre>
<ul class="simple">
<li>Typical Python <strong>import error</strong> message on Linux / UBUNTU if Python modules are missing:</li>
</ul>
<pre class="code literal-block">
Python WARNING [file '/home/johannes/.local/lib/python3.6/site-packages/exudyn/solver.py', line 236]:
Error when executing process ShowVisualizationSettingsDialog':
ModuleNotFoundError: No module named 'tkinter'


|  =&gt;  see installation instructions to install missing Python modules, theDoc.pdf.
</pre>
<ul class="simple">
<li>Problems with <strong>tkinter</strong>, especially on MacOS:</li>
</ul>
<blockquote>
<p>Exudyn uses <tt class="docutils literal">tkinter</tt>, based on tcl/tk, to provide some basic dialogs, such as visualizationSettings</p>
<p>As Python is not suited for multithreading, this causes problems in window and dialog workflows. Especially on MacOS
<tt class="docutils literal">tkinter</tt> is less stable and compatible with the window manager. Especially, <tt class="docutils literal">tkinter</tt> already needs to run
before the application's OpenGL window (renderer) is opened. Therefore, on MacOS <tt class="docutils literal">tkinter.Tk()</tt> is called before the
renderer is started.
In some cases, visualizationSettings dialog may not be available and changes have to be made inside the code.
|  =&gt;  To resolve issues, the following visualizationSettings may help (before starting renderer!), but may reduce functionality:
dialogs.multiThreadedDialogs = False, general.useMultiThreadedRendering = False</p>
</blockquote>
<p><strong>Typical solver errors</strong>:</p>
<ul class="simple">
<li><tt class="docutils literal">SolveDynamic</tt> or <tt class="docutils literal">SolveStatic</tt> <strong>terminated due to errors</strong>:</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  use flag <tt class="docutils literal">showHints = True</tt> in <tt class="docutils literal">SolveDynamic</tt> or <tt class="docutils literal">SolveStatic</tt></div>
</div>
</blockquote>
<ul class="simple">
<li>Very simple example <strong>without loads</strong> leads to error: <tt class="docutils literal">SolveDynamic</tt> or <tt class="docutils literal">SolveStatic</tt> <strong>terminated due to errors</strong>:</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  see also 'Convergence problems', theDoc.pdf</div>
<div class="line">=&gt;  may be caused due to nonlinearity of formulation and round off errors, which restrict Newton to achieve desired tolerances; adjust  <tt class="docutils literal">.newton.relativeTolerance</tt> / <tt class="docutils literal">.newton.absoluteTolerance</tt> in static solver or in time integration</div>
</div>
</blockquote>
<ul class="simple">
<li>Typical <strong>solver error due to redundant constraints or missing inertia terms</strong>, could read as follows:</li>
</ul>
<pre class="code literal-block">
=========================================
SYSTEM ERROR [file 'C:\ProgramData\Anaconda3_64b37\lib\site-packages\exudyn\solver.py', line 207]:
CSolverBase::Newton: System Jacobian seems to be singular / not invertible!
time/load step #1, time = 0.0002
causing system equation number (coordinate number) = 42
=========================================



|  =&gt;  this solver error shows that equation 42 is not solvable. The according coordinate is shown later in such an error message:
</pre>
<pre class="code literal-block">
...
The causing system equation 42 belongs to a algebraic variable (Lagrange multiplier)
Potential object number(s) causing linear solver to fail: [7]
    object 7, name='object7', type=JointGeneric



|  =&gt;  object 7 seems to be the reason, possibly there are too much (joint) constraints applied to your system, check this object.
|  =&gt;  show typical REASONS and SOLUTIONS, by using \ ``showHints=True``\  in \ ``exu.SolveDynamic(...)``\  or \ ``exu.SolveStatic(...)``\
|  =&gt;  You can also \ **highlight**\  object 7 by using the following code in the iPython console:
</pre>
<pre class="code python literal-block">
<span class="name">exu</span><span class="operator">.</span><span class="name">StartRenderer</span><span class="punctuation">()</span>
<span class="name">HighlightItem</span><span class="punctuation">(</span><span class="name">SC</span><span class="punctuation">,</span><span class="name">mbs</span><span class="punctuation">,</span><span class="literal number integer">7</span><span class="punctuation">)</span>
</pre>
<p>which draws the according object in red and others gray/transparent (but sometimes objects may be hidden inside other objects!). See the command's description for further options, e.g., to highlight nodes.</p>
<ul class="simple">
<li>Typical <strong>solver error if Newton does not converge</strong>:</li>
</ul>
<pre class="code literal-block">
+++++++++++++++++++++++++++++++
EXUDYN V1.0.200 solver: implicit second order time integration
  Newton (time/load step #1): convergence failed after 25 iterations; relative error = 0.079958, time = 2
  Newton (time/load step #1): convergence failed after 25 iterations; relative error = 0.0707764, time = 1
  Newton (time/load step #1): convergence failed after 25 iterations; relative error = 0.0185745, time = 0.5
  Newton (time/load step #2): convergence failed after 25 iterations; relative error = 0.332953, time = 0.5
  Newton (time/load step #2): convergence failed after 25 iterations; relative error = 0.0783815, time = 0.375
  Newton (time/load step #2): convergence failed after 25 iterations; relative error = 0.0879718, time = 0.3125
  Newton (time/load step #2): convergence failed after 25 iterations; relative error = 2.84704e-06, time = 0.28125
  Newton (time/load step #3): convergence failed after 25 iterations; relative error = 1.9894e-07, time = 0.28125
STEP348, t = 20 sec, timeToGo = 0 sec, Nit/step = 7.00575
solver finished after 0.258349 seconds.



|  =&gt;  this solver error is caused, because the nonlinear system cannot be solved using Newton's method.
|  =&gt;  the static or dynamic solver by default tries to reduce step size to overcome this problem, but may fail finally (at minimum step size).
|  =&gt;  possible reasons are: too large time steps (reduce step size by using more steps/second), inappropriate initial conditions, or inappropriate joints or constraints (remove joints to see if they are the reason), usually within a singular configuration. Sometimes a system may be just unsolvable in the way you set it up.
|  =&gt;  see also 'Convergence problems', theDoc.pdf
</pre>
<ul class="simple">
<li>Typical solver error if (e.g., syntax) <strong>error in user function</strong> (output may be very long, <strong>read always message on top!</strong>):</li>
</ul>
<pre class="code literal-block">
=========================================
SYSTEM ERROR [file 'C:\ProgramData\Anaconda3_64b37\lib\site-packages\exudyn\solver.py', line 214]:
Error in Python USER FUNCTION 'LoadCoordinate::loadVectorUserFunction' (referred line number my be wrong!):
NameError: name 'sin' is not defined

At:
  C:\DATA\cpp\DocumentationAndInformation\tests\springDamperUserFunctionTest.py(48): Sweep
  C:\DATA\cpp\DocumentationAndInformation\tests\springDamperUserFunctionTest.py(54): userLoad
  C:\ProgramData\Anaconda3_64b37\lib\site-packages\exudyn\solver.py(214): SolveDynamic
  C:\DATA\cpp\DocumentationAndInformation\tests\springDamperUserFunctionTest.py(106): &lt;module&gt;
  C:\ProgramData\Anaconda3_64b37\lib\site-packages\spyder_kernels\customize\spydercustomize.py(377): exec_code
  C:\ProgramData\Anaconda3_64b37\lib\site-packages\spyder_kernels\customize\spydercustomize.py(476): runfile
  &lt;ipython-input-14-323569bebfb4&gt;(1): &lt;module&gt;
  C:\ProgramData\Anaconda3_64b37\lib\site-packages\IPython\core\interactiveshell.py(3331): run_code
...
...
; check your Python code!
=========================================

Solver stopped! use showHints=True to show helpful information



|  =&gt;  this indicates an error in the user function \ ``LoadCoordinate::loadVectorUserFunction``\ , because \ ``sin``\  function has not been defined (must be imported, e.g., from \ ``math``\ ). It indicates that the error occurred in line 48 in \ ``springDamperUserFunctionTest.py``\  within function \ ``Sweep``\ , which has been called from function \ ``userLoad``\ , etc.
</pre>
</div>
<div class="section" id="faq">
<h3>FAQ</h3>
<p><strong>Some frequently asked questions</strong>:</p>
<ul class="simple">
<li>When <strong>importing</strong> Exudyn in Python (windows) I get an error</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  see trouble shooting instructions above!</div>
</div>
</blockquote>
<ul class="simple">
<li>I do not understand the <strong>Python errors</strong> -- how can I find the reason of the error or crash?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  Read trouble shooting section above!</div>
<div class="line">=&gt;  First, you should read all error messages and warnings: from the very first to the last message. Very often, there is a definite line number which shows the error. Note, that if you are executing a string (or module) as a Python code, the line numbers refer to the local line number inside the script or module.</div>
<div class="line">=&gt;  If everything fails, try to execute only part of the code to find out where the first error occurs. By omiting parts of the code, you should find the according source of the error.</div>
<div class="line">=&gt;  If you think, it is a bug: send an email with a representative code snippet, version, etc. to `` <a class="reference external" href="mailto:reply.exudyn&#64;gmail">reply.exudyn&#64;gmail</a>.com``</div>
</div>
</blockquote>
<ul class="simple">
<li>Spyder <strong>console hangs</strong> up, does not show error messages, ...:</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  very often a new start of Spyder helps; most times, it is sufficient to restart the kernel or to just press the 'x' in your IPython console, which closes the current session and restarts the kernel (this is much faster than restarting Spyder)</div>
<div class="line">=&gt;  restarting the IPython console also brings back all error messages</div>
</div>
</blockquote>
<ul class="simple">
<li>Where do I find the <strong>'.exe' file</strong>?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  Exudyn is only available via the Python interface as a module '<tt class="docutils literal">exudyn</tt>', the C++ code being inside of <tt class="docutils literal">exudynCPP.pyd</tt>, which is located in the exudyn folder where you installed the package. This means that you need to <strong>run Python</strong> (best: Spyder) and import the Exudyn module.</div>
</div>
</blockquote>
<ul class="simple">
<li>I get the error message 'check potential mixing of different (object, node, marker, ...) indices', what does it mean?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  probably you used wrong item indexes, see beginning of command interface in theDoc.pdf.</div>
<div class="line">=&gt;  E.g., an object number <tt class="docutils literal">oNum = <span class="pre">mbs.AddObject(...)</span></tt> is used at a place where a <tt class="docutils literal">NodeIndex</tt> is expected, e.g., <tt class="docutils literal">mbs.AddObject(MassPoint(nodeNumber=oNum, <span class="pre">...))</span></tt></div>
<div class="line">=&gt;  Usually, this is an ERROR in your code, it does not make sense to mix up these indexes!</div>
<div class="line">=&gt;  In the exceptional case, that you want to convert numbers, see beginning of theDoc.pdf.</div>
</div>
</blockquote>
<ul class="simple">
<li>Why does <strong>type auto completion</strong> not work for mbs (MainSystem)?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  UPDATE 2020-06-01: with Spyder 4, using Python 3.7, type auto completion works much better, but may find too many completions.</div>
<div class="line">=&gt;  most Python environments (e.g., with Spyder 3) only have information up to the first sub-structure, e.g., <tt class="docutils literal">SC=exu.SystemContainer()</tt> provides full access to SC in the type completion, but <tt class="docutils literal">mbs=SC.AddSystem()</tt> is at the second sub-structure of the module and is not accessible.</div>
<div class="line">=&gt;  WORKAROUND: type <tt class="docutils literal">mbs=MainSystem()</tt> <strong>before</strong> the <tt class="docutils literal">mbs=SC.AddSystem()</tt> command and the interpreter will know what type mbs is. This also works for settings, e.g., simulation settings 'Newton'.</div>
</div>
</blockquote>
<ul class="simple">
<li>How to add graphics?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  Graphics (lines, text, 3D triangular / sSTL mesh) can be added to all BodyGraphicsData items in objects. Graphics objects which are fixed with the background can be attached to a ObjectGround object. Moving objects must be attached to the BodyGraphicsData of a moving body. Other moving bodies can be realized, e.g., by adding a ObjectGround and changing its reference with time. Furthermore, ObjectGround allows to add fully user defined graphics.</div>
</div>
</blockquote>
<ul class="simple">
<li>In <tt class="docutils literal">GenerateStraightLineANCFCable2D</tt></li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  coordinate constraints can be used to constrain position and rotation, e.g., <tt class="docutils literal">fixedConstraintsNode0 = [1,1,0,1]</tt> for a beam aligned along the global x-axis;</div>
<div class="line">=&gt;  this <strong>does not work</strong> for beams with arbitrary rotation in reference configuration, e.g., 45°. Use a GenericJoint with a rotationMarker instead.</div>
</div>
</blockquote>
<ul class="simple">
<li>What is the difference between MarkerBodyPosition and MarkerBodyRigid?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  Position markers (and nodes) do not have information on the orientation (rotation). For that reason, there is a difference between position based and rigid-body based markers. In case of a rigid body attached to ground with a SpringDamper, you can use both, MarkerBodyPosition or MarkerBodyRigid, markers. For a prismatic joint, you will need a MarkerBodyRigid.</div>
</div>
</blockquote>
<ul class="simple">
<li>I get an error in <tt class="docutils literal">exu.SolveDynamic(mbs, <span class="pre">...)</span></tt> OR in <tt class="docutils literal">exu.SolveStatic(mbs, <span class="pre">...)</span></tt> but no further information -- how can I solve it?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  Typical <strong>time integration errors</strong> may look like:</div>
</div>
</blockquote>
<pre class="code literal-block">
File &quot;C:/DATA/cpp/EXUDYN_git/main/pythonDev/...&lt;file name&gt;&quot;, line XXX, in &lt;module&gt;
solver.SolveSystem(...)
SystemError: &lt;built-in method SolveSystem of PyCapsule object at 0x0CC63590&gt; returned a result with an error set


|  =&gt;  The pre-checks, which are performed to enable a crash-free simulation are insufficient for your model
|  =&gt;  As a first try, \ **restart the IPython console**\  in order to get all error messages, which may be blocked due to a previous run of Exudyn.
|  =&gt;  Very likely, you are using Python user functions inside Exudyn : They lead to an internal Python error, which is not always catched by Exudyn ; e.g., a load user function UFload(mbs,~t,~load), which tries to access component load[3] of a load vector with 3 components will fail internally;
|  =&gt;  Use the print(...) command in Python at many places to find a possible error in user functions (e.g., put \ ``print(&quot;Start user function XYZ&quot;)``\  at the beginning of every user function; test user functions from iPython console
|  =&gt;  It is also possible, that you are using inconsistent data, which leads to the crash. In that case, you should try to change your model: omit parts and find out which part is causing your error
|  =&gt;  see also \ **I do not understand the Python errors -- how can I find the cause?**\
</pre>
<ul class="simple">
<li>Why can't I get the focus of the simulation window on startup (render window hidden)?</li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  Starting Exudyn out of Spyder might not bring the simulation window to front, because of specific settings in Spyder(version 3.2.8), e.g., Tools=&gt;Preferences=&gt;Editor=&gt;Advanced settings: uncheck 'Maintain focus in the Editor after running cells or selections'; Alternatively, set <tt class="docutils literal">SC.visualizationSettings.window.alwaysOnTop=True</tt> <strong>before</strong> starting the renderer with <tt class="docutils literal">exu.StartRenderer()</tt></div>
</div>
</blockquote>
</div>
</div>
</div>
<div class="section" id="overview-on-exudyn">
<h1>Overview on Exudyn</h1>
<div class="section" id="module-structure">
<h2>Module structure</h2>
<p>This section will show:</p>
<ul class="simple">
<li>Overview of modules</li>
<li>Conventions: dimension of nodes, objects and vectors</li>
<li>Coordinates: reference coordinates and displacements</li>
<li>Nodes, Objects, Markers and Loads</li>
</ul>
<p>For an introduction to the solvers, see theDoc.pdf.</p>
<div class="section" id="overview-of-modules">
<h3>Overview of modules</h3>
<p>Currently, the Exudyn module structure is split into a C++ core part and a set of Python parts,
see Figs. [theDoc.pdf].</p>
<ul class="simple">
<li><strong>C++ parts</strong>, see Figs. [theDoc.pdf] and [theDoc.pdf]:</li>
</ul>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal">exudyn</tt>:
on this level, there are just very few functions: <tt class="docutils literal">SystemContainer()</tt>, <tt class="docutils literal">StartRenderer()</tt>, <tt class="docutils literal">StopRenderer()</tt>, <tt class="docutils literal">GetVersionString()</tt>, <tt class="docutils literal"><span class="pre">SolveStatic(...)</span></tt>, <tt class="docutils literal"><span class="pre">SolveDynamic(...)</span></tt>, ... as well as system and user variable dictionaries <tt class="docutils literal">exudyn.variables</tt> and <tt class="docutils literal">exudyn.sys</tt></li>
<li><tt class="docutils literal">SystemContainer</tt>: contains the systems (most important), solvers (static, dynamics, ...), visualization settings</li>
<li><tt class="docutils literal">mbs</tt>: fmbs created with <tt class="docutils literal">mbs = SC.AddSystem()</tt>, this structure contains everything that defines a solvable multibody system; a large set of nodes, objects, markers,
loads can added to the system, see theDoc.pdf;</li>
<li><tt class="docutils literal">mbs.systemData</tt>: contains the initial, current, visualization, ... states of the system and holds the items, see [figure in theDoc.pdf]</li>
</ul>
</blockquote>
<ul class="simple">
<li><strong>Python parts</strong> (this list is continuously extended, see theDoc.pdf), sorted by importance:</li>
</ul>
<blockquote>
<ul class="simple">
<li><tt class="docutils literal">exudyn.utilities</tt>: constains helper classes in Python and includes Exudyn modules <tt class="docutils literal">basicUtilities</tt>, <tt class="docutils literal">rigidBodyUtilities</tt>, <tt class="docutils literal">graphicsDataUtilities</tt>, and <tt class="docutils literal">itemInterface</tt>, which is recommended to be loaded at beginning of your model file</li>
<li><tt class="docutils literal">exudyn.itemInterface</tt>: contains the interface, which transfers Python classes (e.g., of a NodePoint) to dictionaries that can be understood by the C++ module</li>
<li><tt class="docutils literal">exudyn.basicUtilities</tt>: contains basic helper classes, without importing numpy</li>
<li><tt class="docutils literal">exudyn.rigidBodyUtilities</tt>: contains important helper classes for creation of rigid body inertia, rigid bodies, and rigid body joints; includes helper functions for rotation parameterization, rotation matrices, homogeneous transformations, etc.</li>
<li><tt class="docutils literal">exudyn.graphicsDataUtilities</tt>: provides some basic drawing utilities, definition of colors and basic drawing objects (including sSTL import); rotation/translation of graphicsData objects</li>
<li><tt class="docutils literal">exudyn.plot</tt>: contains PlotSensor(...), a very versatile interface to matplotlib and other valuable helper functions</li>
<li><tt class="docutils literal">exudyn.processing</tt>: methods for optimization, parameter variation, sensitivity analysis, etc.</li>
<li><tt class="docutils literal">exudyn.FEM</tt>: everything related to finite element import and creation of model order reduction flexible bodies</li>
<li><tt class="docutils literal">exudyn.robotics</tt>: submodule containing several helper modules related to manipulators (<tt class="docutils literal">robotics</tt>, <tt class="docutils literal">robotics.models</tt>), mobile robots (<tt class="docutils literal">robotics.mobile</tt>), trajectory generation (<tt class="docutils literal">robotics.motion</tt>), etc.</li>
<li><tt class="docutils literal">exudyn.beams</tt>: helper functions for creation of beams along straight lines and curves, sliding joints, etc.</li>
<li><tt class="docutils literal">exudyn.interactive</tt>: helper classes to create interactive models (e.g. for teaching or demos)</li>
<li><tt class="docutils literal">exudyn.physics</tt>: containing helper functions, which are physics related such as friction</li>
<li><tt class="docutils literal">exudyn.signalProcessing</tt>: filters, FFT, etc.; interfaces to scipy and numpy methods</li>
<li><tt class="docutils literal">exudyn.solver</tt>: functions imported when loading <tt class="docutils literal">exudyn</tt>, containing main solvers</li>
</ul>
</blockquote>
</div>
<div class="section" id="conventions-items-indexes-coordinates">
<h3>Conventions: items, indexes, coordinates</h3>
<p>In this documentation, we will use the term <strong>item</strong> to identify nodes, objects, markers, loads and sensors:</p>
<blockquote>
item in node, object, marker, load, sensor </blockquote>
<p><strong>Indexes: arrays and vectors starting with 0:</strong></p>
<p>As known from Python, all <strong>indexes</strong> of arrays, vectors, matrices, ... are starting with 0. This means that the first component of the vector <tt class="docutils literal"><span class="pre">v=[1,2,3]</span></tt> is accessed with <tt class="docutils literal">v[0]</tt> in Python (and also in the C++ part of Exudyn ). The range is usually defined as <tt class="docutils literal">range(0,3)</tt>, in which '3' marks the index after the last valid component of an array or vector.</p>
<p><strong>Dimensionality of objects and vectors:</strong> 2D vs. 3D</p>
<p>As a convention, quantities in Exudyn are 3D, such as nodes, objects, markers, loads, measured quantities, etc.
For that reason, we denote planar nodes, objects, etc. with the suffix 2D, but 3D objects do not get this suffix (There are some rare exceptions, such as Beam3D as the pure beam may easily lead to name space conflicts in Python).</p>
<p>Output and input to objects, markers, loads, etc. is usually given by 3D vectors (or matrices), such as (local) position, force, torque, rotation, etc. However, initial and reference values for nodes depend on their dimensionality.
As an example, consider a <tt class="docutils literal">NodePoint2D</tt>:</p>
<ul class="simple">
<li><tt class="docutils literal">referenceCoordinates</tt> is a 2D vector (but could be any dimension in general nodes)</li>
<li>measuring the current position of <tt class="docutils literal">NodePoint2D</tt> gives a 3D vector</li>
<li>when attaching a <tt class="docutils literal">MarkerNodePosition</tt> and a <tt class="docutils literal">LoadForceVector</tt>, the force will be still a 3D vector</li>
</ul>
<p>Furthermore, the local position in 2D objects is provided by a 3D vector. Usually, the dimensionality is given in the reference manual. User errors in the dimensionality will be usually detected either by the Python interface (i.e., at the time the item is created) or by the system-preprocessor</p>
</div>
</div>
<div class="section" id="items-nodes-objects-loads-markers-sensors">
<h2>Items: Nodes, Objects, Loads, Markers, Sensors, ...</h2>
<p>In this section, the most important part of Exudyn are provided. An overview of the interaction of the items is given in [figure in theDoc.pdf]</p>
<div class="section" id="nodes">
<h3>Nodes</h3>
<p>Nodes provide the coordinates (and the degrees of freedom) to the system. They have no mass, stiffness or whatsoever assigned.
Without nodes, the system has no unknown coordinates.
Adding a node provides (for the system unknown) coordinates. In addition we also need equations for every nodal coordinate -- otherwise the system cannot be computed (NOTE: this is currently not checked by the preprocessor).</p>
</div>
<div class="section" id="objects">
<h3>Objects</h3>
<p>Objects are 'computational objects' and they provide equations to your system. Objects often provide derivatives and have measurable quantities (e.g. displacement) and they provide access, which can be used to apply, e.g., forces. Some of this functionality is only available in C++, but not in Python.</p>
<p>Objects can be a:</p>
<ul class="simple">
<li>general object (e.g. a controller, user defined object, ...; no example yet)</li>
<li>body: has a mass or mass distribution; markers can be placed on bodies; loads can be applied; constraints can be attached via markers; bodies can be:</li>
</ul>
<blockquote>
<ul class="simple">
<li>ground object: has no nodes</li>
<li>simple body: has one node (e.g. mass point, rigid body)</li>
<li>finite element and more complicated body (e.g. FFRF-object): has more than one node</li>
</ul>
</blockquote>
<ul class="simple">
<li>connector: uses markers to connect nodes and/or bodies; adds additional terms to system equations either based on stiffness/damping or with constraints (and Lagrange multipliers). Possible connectors:</li>
</ul>
<blockquote>
<ul class="simple">
<li>algebraic constraint (e.g. constrain two coordinates: q_1 = q_2)</li>
<li>classical joint</li>
<li>spring-damper or penalty constraint</li>
</ul>
</blockquote>
</div>
<div class="section" id="markers">
<h3>Markers</h3>
<p>Markers are interfaces between objects/nodes and constraints/loads.
A constraint (which is also an object) or load cannot act directly on a node or object without a marker.
As a benefit, the constraint or load does not need to know whether it is applied, e.g., to a node or to a local position of a body.</p>
<p>Typical situations are:</p>
<ul class="simple">
<li>Node -- Marker -- Load</li>
<li>Node -- Marker -- Constraint (object)</li>
<li>Body(object) -- Marker -- Load</li>
<li>Body1 -- Marker1 -- Joint(object) -- Marker2 -- Body2</li>
</ul>
</div>
<div class="section" id="loads">
<h3>Loads</h3>
<p>Loads are used to apply forces and torques to the system. The load values are static values. However, you can use Python functionality to modify loads either by linearly increasing them during static computation or by using the 'mbs.SetPreStepUserFunction(...)' structure in order to modify loads in every integration step depending on time or on measured quantities (thus, creating a controller).</p>
</div>
<div class="section" id="sensors">
<h3>Sensors</h3>
<p>Sensors are only used to measure output variables (values) in order to simpler generate the requested output quantities.
They have a very weak influence on the system, because they are only evaluated after certain solver steps as requested by the user.</p>
</div>
<div class="section" id="reference-coordinates-and-displacements">
<h3>Reference coordinates and displacements</h3>
<p>Nodes usually have separated reference and initial quantities. Here,
<tt class="docutils literal">referenceCoordinates</tt> are the coordinates for which the system is defined upon creation. Reference coordinates are needed, e.g., for definition of joints and for the reference configuration of finite elements. In many cases it marks the undeformed configuration (e.g., with finite elements), but not, e.g., for <tt class="docutils literal">ObjectConnectorSpringDamper</tt>, which has its own reference length.</p>
<p>Initial displacement (or rotation) values are provided separately, in order to start a system from a configuration different from the reference configuration.
As an example, the initial configuration of a <tt class="docutils literal">NodePoint</tt> is given by <tt class="docutils literal">referenceCoordinates + initialCoordinates</tt>, while the initial state of a dynamic system additionally needs <tt class="docutils literal">initialVelocities</tt>.</p>
</div>
</div>
<div class="section" id="mapping-between-local-and-global-coordinate-indices">
<h2>Mapping between local and global coordinate indices</h2>
<p>The LTG-index-mappings (coordinate transformations!) between local coordinate <strong>indices</strong>, on node or object level, and global (=system) coordinate <strong>indices</strong> follows the following rules:</p>
<ul class="simple">
<li>LTG-index-mappings are computed during <tt class="docutils literal">mbs.Assemble()</tt> and are not available before.</li>
<li>Nodes own a global index which relates the local coordinates to global (system) coordinate. E.g., for a ODE2 node with node number <tt class="docutils literal">i</tt>, this index can be obtained via the function <tt class="docutils literal">mbs.GetNodeODE2Index(i)</tt>.</li>
<li>The order of global coordinates is simply following the node numbering. If we add three nodes <tt class="docutils literal">NodePoint</tt>, the system will contain 9 coordinates, where the first triple (starting index 0) belongs to node 0, the second triple (starting index 3) belongs to node 1 and the third triple (starting index 6) belongs to node 2. After <tt class="docutils literal">mbs.Assemble()</tt>, you can access the system coordinates via <tt class="docutils literal">mbs.systemData.GetODE2Coordinates()</tt>, which returns a numpy array with 9 coordinates, containing the initial values provided in <tt class="docutils literal">NodePoint</tt> (default: zero).</li>
<li>Objects have their own LTG-index-mappings for their respective coordinate types. The ODE2 coordinates of an object <tt class="docutils literal">j</tt> can be retrieved via <tt class="docutils literal">mbs.systemData.GetObjectLTGODE2(j)</tt>. For a body, these are the global ODE2 coordinates representing the body; for a connector, these are the coordinates to which the connector is linked (usually coordinates of two bodies); for a ground object, the LTG-index-mapping is empty; see also theDoc.pdf.</li>
<li>Constraints create algebraic variables (Lagrange multipliers) automatically. For a constraint with object number <tt class="docutils literal">k</tt>, the global index to algebraic variables (of AE-type) can be accessed via <tt class="docutils literal">mbs.systemData.GetObjectLTGAE(k)</tt>.</li>
</ul>
</div>
<div class="section" id="exudyn-basics">
<h2>Exudyn Basics</h2>
<p>This section will show:</p>
<ul class="simple">
<li>Interaction with the Exudyn module</li>
<li>Simulation settings</li>
<li>Visualization settings</li>
<li>Generating output and results</li>
<li>Graphics pipeline</li>
<li>Generating animations</li>
</ul>
<div class="section" id="interaction-with-the-exudyn-module">
<h3>Interaction with the Exudyn module</h3>
<p>It is important that the Exudyn module is basically a state machine, where you create items on the C++ side using the Python interface. This helps you to easily set up models using many other Python modules (numpy, sympy, matplotlib, ...) while the computation will be performed in the end on the C++ side in a very efficient manner.</p>
<p><strong>Where do objects live?</strong></p>
<p>Whenever a system container is created with <tt class="docutils literal">SC = exu.SystemContainer()</tt>, the structure <tt class="docutils literal">SC</tt> becomes a variable in the Python interpreter, but it is managed inside the C++ code and it can be modified via the Python interface.
Usually, the system container will hold at least one system, usually called <tt class="docutils literal">mbs</tt>.
Commands such as <tt class="docutils literal"><span class="pre">mbs.AddNode(...)</span></tt> add objects to the system <tt class="docutils literal">mbs</tt>.
The system will be prepared for simulation by <tt class="docutils literal">mbs.Assemble()</tt> and can be solved (e.g., using <tt class="docutils literal"><span class="pre">exu.SolveDynamic(...)</span></tt>) and evaluated hereafter using the results files.
Using <tt class="docutils literal">mbs.Reset()</tt> will clear the system and allows to set up a new system. Items can be modified (<tt class="docutils literal"><span class="pre">ModifyObject(...)</span></tt>) after first initialization, even during simulation.</p>
</div>
<div class="section" id="simulation-settings">
<h3>Simulation settings</h3>
<p>The simulation settings consists of a couple of substructures, e.g., for <tt class="docutils literal">solutionSettings</tt>, <tt class="docutils literal">staticSolver</tt>, <tt class="docutils literal">timeIntegration</tt> as well as a couple of general options -- for details see Sections [theDoc.pdf] -- [theDoc.pdf].</p>
<p>Simulation settings are needed for every solver. They contain solver-specific parameters (e.g., the way how load steps are applied), information on how solution files are written, and very specific control parameters, e.g., for the Newton solver.</p>
<p>The simulation settings structure is created with</p>
<pre class="code python literal-block">
<span class="name">simulationSettings</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">SimulationSettings</span><span class="punctuation">()</span>
</pre>
<p>Hereafter, values of the structure can be modified, e.g.,</p>
<pre class="code python literal-block">
<span class="name">tEnd</span> <span class="operator">=</span> <span class="literal number integer">10</span> <span class="comment single">#10 seconds of simulation time:</span>
<span class="name">h</span> <span class="operator">=</span> <span class="literal number float">0.01</span>  <span class="comment single">#step size (gives 1000 steps)</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">endTime</span> <span class="operator">=</span> <span class="name">tEnd</span>
<span class="comment single">#steps for time integration must be integer:</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">numberOfSteps</span> <span class="operator">=</span> <span class="name builtin">int</span><span class="punctuation">(</span><span class="name">tEnd</span><span class="operator">/</span><span class="name">h</span><span class="punctuation">)</span>
<span class="comment single">#assigns a new tolerance for Newton's method:</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">newton</span><span class="operator">.</span><span class="name">relativeTolerance</span> <span class="operator">=</span> <span class="literal number float">1e-9</span>
<span class="comment single">#write some output while the solver is active (SLOWER):</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">verboseMode</span> <span class="operator">=</span> <span class="literal number integer">2</span>
<span class="comment single">#write solution every 0.1 seconds:</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">solutionWritePeriod</span> <span class="operator">=</span> <span class="literal number float">0.1</span>
<span class="comment single">#use sparse matrix storage and solver (package Eigen):</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">linearSolverType</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">LinearSolverType</span><span class="operator">.</span><span class="name">EigenSparse</span>
</pre>
</div>
<div class="section" id="generating-output-and-results">
<h3>Generating output and results</h3>
<p>The solvers provide a number of options in <tt class="docutils literal">solutionSettings</tt> to generate a solution file. As a default, exporting solution to the solution file is activated with a writing period of 0.01 seconds.</p>
<p>Typical output settings are:</p>
<pre class="code python literal-block">
<span class="comment single">#create a new simulationSettings structure:</span>
<span class="name">simulationSettings</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">SimulationSettings</span><span class="punctuation">()</span>

<span class="comment single">#activate writing to solution file:</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">writeSolutionToFile</span> <span class="operator">=</span> <span class="keyword constant">True</span>
<span class="comment single">#write results every 1ms:</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">solutionWritePeriod</span> <span class="operator">=</span> <span class="literal number float">0.001</span>

<span class="comment single">#assign new filename to solution file</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">coordinatesSolutionFileName</span><span class="operator">=</span> <span class="literal string double">&quot;myOutput.txt&quot;</span>

<span class="comment single">#do not export certain coordinates:</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">exportDataCoordinates</span> <span class="operator">=</span> <span class="keyword constant">False</span>
</pre>
</div>
<div class="section" id="visualization-settings-dialog">
<h3>Visualization settings dialog</h3>
<p>Visualization settings are used for user interaction with the model. E.g., the nodes, markers, loads, etc., can be visualized for every model. There are default values, e.g., for the size of nodes, which may be inappropriate for your model. Therefore, you can adjust those parameters. In some cases, huge models require simpler graphics representation, in order not to slow down performance -- e.g., the number of faces to represent a cylinder should be small if there are 10000s of cylinders drawn. Even computation performance can be slowed down, if visualization takes lots of CPU power. However, visualization is performed in a separate thread, which usually does not influence the computation exhaustively.</p>
<p>Details on visualization settings and its substructures are provided in Sections [theDoc.pdf] -- [theDoc.pdf]. These settings may also be edited by pressing 'V' in the active render window (does not work, if there is no active render loop using, e.g., <tt class="docutils literal">SC.WaitForRenderEngineStopFlag()</tt> or
<tt class="docutils literal">mbs.WaitForUserToContinue()</tt> ).</p>
<p>Note that this dialog is automatically created and uses Python's <tt class="docutils literal">tkinter</tt>, which is lightweight, but not very well suited if display scalings are large (e.g., on high resolution laptop screens). If working with Spyder, it is recommended to restart Spyder, if display scaling is changed, in order to adjust scaling not only for Spyder but also for Exudyn .</p>
<p>The appearance of visualization settings dialogs may be adjusted by directly modifying <tt class="docutils literal">exudyn.GUI</tt> variables (this may change in the future). For example write in your code before opening the render window (treeEdit and treeview both mean the settings dialog currently used for visualization settings and partially for right-mouse-click):</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">exudyn.GUI</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">dialogDefaultWidth</span>             <span class="comment single">#unscaled width of, e.g., right-mouse-button dialog</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">treeEditDefaultWidth</span> <span class="operator">=</span> <span class="literal number integer">800</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">treeEditDefaultHeight</span> <span class="operator">=</span> <span class="literal number integer">600</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">treeEditMaxInitialHeight</span> <span class="operator">=</span> <span class="literal number integer">600</span> <span class="comment single">#otherwise height is increased for larger screens</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">treeEditOpenItems</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="literal string single">'general'</span><span class="punctuation">,</span><span class="literal string single">'contact'</span><span class="punctuation">]</span> <span class="comment single">#these tree items are opened each time the dialog is opened</span>
<span class="comment single">#</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">treeviewDefaultFontSize</span>        <span class="comment single">#this is the base font size of the dialog (also right-mouse-button dialog)</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">useRenderWindowDisplayScaling</span>  <span class="comment single">#if True, the scaling will follow the current scaling of the render window; if False, it will use the \ ``tkinter``\  internal scaling, which uses the main screen where the dialog is created (which won't scale well, if the window is moved to another screen).</span>
<span class="comment single">#</span>
<span class="name">exudyn</span><span class="operator">.</span><span class="name">GUI</span><span class="operator">.</span><span class="name">textHeightFactor</span> <span class="operator">=</span> <span class="literal number float">1.45</span>        <span class="comment single">#this factor is used to increase height of lines in tree view as compared to font size</span>
</pre>
<p><img alt="picVisSettings" src="docs/theDoc/figures/visualizationSettings.png" style="width: 60%;" /></p>
<p>[View of visualization settings (press 'V' in render window to open dialog).]</p>
<p>The visualization settings structure can be accessed in the system container <tt class="docutils literal">SC</tt> (access per reference, no copying!), accessing every value or structure directly, e.g.,</p>
<pre class="code python literal-block">
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">nodes</span><span class="operator">.</span><span class="name">defaultSize</span> <span class="operator">=</span> <span class="literal number float">0.001</span>      <span class="comment single">#draw nodes very small</span>

<span class="comment single">#change openGL parameters; current values can be obtained from SC.GetRenderState()</span>
<span class="comment single">#change zoom factor:</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">openGL</span><span class="operator">.</span><span class="name">initialZoom</span> <span class="operator">=</span> <span class="literal number float">0.2</span>
<span class="comment single">#set the center point of the scene (can be attached to moving object):</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">openGL</span><span class="operator">.</span><span class="name">initialCenterPoint</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="literal number float">0.192</span><span class="punctuation">,</span> <span class="operator">-</span><span class="literal number float">0.0039</span><span class="punctuation">,</span><span class="operator">-</span><span class="literal number float">0.075</span><span class="punctuation">]</span>

<span class="comment single">#turn of auto-fit:</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">general</span><span class="operator">.</span><span class="name">autoFitScene</span> <span class="operator">=</span> <span class="keyword constant">False</span>

<span class="comment single">#change smoothness of a cylinder:</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">general</span><span class="operator">.</span><span class="name">cylinderTiling</span> <span class="operator">=</span> <span class="literal number integer">100</span>

<span class="comment single">#make round objects flat:</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">openGL</span><span class="operator">.</span><span class="name">shadeModelSmooth</span> <span class="operator">=</span> <span class="keyword constant">False</span>

<span class="comment single">#turn on coloured plot, using y-component of displacements:</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">contour</span><span class="operator">.</span><span class="name">outputVariable</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">OutputVariableType</span><span class="operator">.</span><span class="name">Displacement</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">contour</span><span class="operator">.</span><span class="name">outputVariableComponent</span> <span class="operator">=</span> <span class="literal number integer">1</span> <span class="comment single">#0=x, 1=y, 2=z</span>
</pre>
</div>
<div class="section" id="renderer-and-3d-graphics">
<h3>Renderer and 3D graphics</h3>
<p>A 3D renderer is attached to the simulation. Visualization is started with  <tt class="docutils literal">exu.StartRenderer()</tt>, see the examples and tutorials.
The renderer uses an OpenGL window of a library called GLFW, which is platform-independent.
The renderer is set up in a minimalistic way, just to ensure that you can check that the modeling is correct. There is no way to contruct models with the renderer. Try to avoid huge number of triangles in STL files or by creating large number of complex objects, such as spheres or cylinders.</p>
<p>There are some main features in the renderer, using keyboard and mouse:</p>
<ul class="simple">
<li>press key H to show help in renderer</li>
<li>move model by pressing left mouse button and drag</li>
<li>rotate model by pressing right mouse button and drag</li>
<li>change visibility (wire frame, solid, transparent, ...) by pressing T</li>
<li>zoom all: key A</li>
<li>open visualization dialog: key V</li>
<li>show item number: click on graphics element with left mouse button</li>
<li>show item dictionary: click on graphics element with right mouse button</li>
<li>... (see theDoc.pdfff.)</li>
</ul>
<p>Depending on your model (size, place, ...), you may need to adjust the following <tt class="docutils literal">openGL</tt> parameters in <tt class="docutils literal">visualizationSettings</tt>:</p>
<ul class="simple">
<li>light and light position</li>
<li>shadow (turned off by using 0; turned on by using, e.g., a value of 0.3) and shadow polygon offset; shadow slows down graphics performance by a factor of 2-3, depending on your graphics card</li>
<li>visibility of nodes, markers, etc. in according bodies, nodes, markers, ..., <tt class="docutils literal">visualizationSettings</tt></li>
<li>move camera with a selected marker: adjust <tt class="docutils literal">trackMarker</tt> in <tt class="docutils literal">visualizationSettings.interactive</tt></li>
<li>... (see theDoc.pdfff.)</li>
</ul>
</div>
<div class="section" id="graphics-pipeline">
<h3>Graphics pipeline</h3>
<p>There are basically two loops during simulation, which feed the graphics pipeline.
The solver runs a loop:</p>
<ul class="simple">
<li>compute step (or set up initial values)</li>
<li>finish computation step; results are in current state</li>
<li>copy current state to visualization state (thread safe)</li>
<li>signal graphics pipeline that new visualization data is available</li>
<li>the renderer may update the visualization depending on <tt class="docutils literal">graphicsUpdateInterval</tt> in <tt class="docutils literal">visualizationSettings.general</tt></li>
</ul>
<p>The openGL graphics thread (=separate thread) runs the following loop:</p>
<ul class="simple">
<li>render openGL scene with a given graphicsData structure (containing lines, faces, text, ...)</li>
<li>go idle for some milliseconds</li>
<li>check if openGL rendering needs an update (e.g. due to user interaction)
=&gt; if update is needed, the visualization of all items is updated -- stored in a graphicsData structure)</li>
<li>check if new visualization data is available and the time since last update is larger than a presribed value, the graphicsData structure is updated with the new visualization state</li>
</ul>
</div>
<div class="section" id="storing-the-model-view">
<h3>Storing the model view</h3>
<p>There is a simple way to store the current view (zoom, centerpoint, orientation, etc.) by using <tt class="docutils literal">SC.GetRenderState()</tt> and <tt class="docutils literal">SC.SetRenderState()</tt>,
see also theDoc.pdf.
A simple way is to reload the stored render state (model view) after simulating your model once at the end of the simulation (
note that <tt class="docutils literal">visualizationSettings.general.autoFitScene</tt> should be set False if you want to use the stored zoom factor):</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">exudyn</span> <span class="keyword">as</span> <span class="name namespace">exu</span>
<span class="name">SC</span><span class="operator">=</span><span class="name">exu</span><span class="operator">.</span><span class="name">SystemContainer</span><span class="punctuation">()</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">general</span><span class="operator">.</span><span class="name">autoFitScene</span> <span class="operator">=</span> <span class="keyword constant">False</span> <span class="comment single">#prevent from autozoom</span>
<span class="name">exu</span><span class="operator">.</span><span class="name">StartRenderer</span><span class="punctuation">()</span>
<span class="keyword">if</span> <span class="literal string single">'renderState'</span> <span class="operator word">in</span> <span class="name">exu</span><span class="operator">.</span><span class="name">sys</span><span class="punctuation">:</span>
    <span class="name">SC</span><span class="operator">.</span><span class="name">SetRenderState</span><span class="punctuation">(</span><span class="name">exu</span><span class="operator">.</span><span class="name">sys</span><span class="punctuation">[</span><span class="literal string single">'renderState'</span><span class="punctuation">])</span>
<span class="comment single">#+++++++++++++++</span>
<span class="comment single">#do simulation here and adjust model view settings with mouse</span>
<span class="comment single">#+++++++++++++++</span>

<span class="comment single">#store model view for next run:</span>
<span class="name">StopRenderer</span><span class="punctuation">()</span> <span class="comment single">#stores render state in exu.sys['renderState']</span>
</pre>
<p>Alternatively, you can obtain the current model view from the console after a simulation, e.g.,</p>
<pre class="code python literal-block">
<span class="name">In</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="punctuation">:</span> <span class="name">SC</span><span class="operator">.</span><span class="name">GetRenderState</span><span class="punctuation">()</span>
<span class="name">Out</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]:</span>
<span class="literal string single">'centerPoint'</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="literal number float">1.0</span><span class="punctuation">,</span> <span class="literal number float">0.0</span><span class="punctuation">,</span> <span class="literal number float">0.0</span><span class="punctuation">],</span>
 <span class="literal string single">'maxSceneSize'</span><span class="punctuation">:</span> <span class="literal number float">2.0</span><span class="punctuation">,</span>
 <span class="literal string single">'zoom'</span><span class="punctuation">:</span> <span class="literal number float">1.0</span><span class="punctuation">,</span>
 <span class="literal string single">'currentWindowSize'</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="literal number integer">1024</span><span class="punctuation">,</span> <span class="literal number integer">768</span><span class="punctuation">],</span>
 <span class="literal string single">'modelRotation'</span><span class="punctuation">:</span> <span class="punctuation">[[</span> <span class="literal number float">0.34202015</span><span class="punctuation">,</span>  <span class="literal number float">0.</span>        <span class="punctuation">,</span> <span class="literal number float">0.9396926</span> <span class="punctuation">],</span>
                   <span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.60402274</span><span class="punctuation">,</span>  <span class="literal number float">0.76604444</span><span class="punctuation">,</span> <span class="literal number float">0.21984631</span><span class="punctuation">],</span>
                   <span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.7198463</span> <span class="punctuation">,</span> <span class="operator">-</span><span class="literal number float">0.6427876</span> <span class="punctuation">,</span> <span class="literal number float">0.26200265</span><span class="punctuation">]])</span>
</pre>
<p>which contains the last state of the renderer.
Now copy the output and set this with <tt class="docutils literal">SC.SetRenderState</tt> in your Python code to have a fixed model view in every simulation (<tt class="docutils literal">SC.SetRenderState</tt> AFTER <tt class="docutils literal">exu.StartRenderer()</tt>):</p>
<pre class="code python literal-block">
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">general</span><span class="operator">.</span><span class="name">autoFitScene</span> <span class="operator">=</span> <span class="keyword constant">False</span> <span class="comment single">#prevent from autozoom</span>
<span class="name">exu</span><span class="operator">.</span><span class="name">StartRenderer</span><span class="punctuation">()</span>
<span class="name">renderState</span><span class="operator">=</span><span class="literal string single">'centerPoint'</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="literal number float">1.0</span><span class="punctuation">,</span> <span class="literal number float">0.0</span><span class="punctuation">,</span> <span class="literal number float">0.0</span><span class="punctuation">],</span>
             <span class="literal string single">'maxSceneSize'</span><span class="punctuation">:</span> <span class="literal number float">2.0</span><span class="punctuation">,</span>
             <span class="literal string single">'zoom'</span><span class="punctuation">:</span> <span class="literal number float">1.0</span><span class="punctuation">,</span>
             <span class="literal string single">'currentWindowSize'</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="literal number integer">1024</span><span class="punctuation">,</span> <span class="literal number integer">768</span><span class="punctuation">],</span>
             <span class="literal string single">'modelRotation'</span><span class="punctuation">:</span>     <span class="punctuation">[[</span> <span class="literal number float">0.34202015</span><span class="punctuation">,</span>  <span class="literal number float">0.</span>        <span class="punctuation">,</span>  <span class="literal number float">0.9396926</span> <span class="punctuation">],</span>
                                  <span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.60402274</span><span class="punctuation">,</span>  <span class="literal number float">0.76604444</span><span class="punctuation">,</span>  <span class="literal number float">0.21984631</span><span class="punctuation">],</span>
                                  <span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.7198463</span> <span class="punctuation">,</span> <span class="operator">-</span><span class="literal number float">0.6427876</span> <span class="punctuation">,</span>  <span class="literal number float">0.26200265</span><span class="punctuation">]])</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">SetRenderState</span><span class="punctuation">(</span><span class="name">renderState</span><span class="punctuation">)</span>
<span class="comment single">#.... further code for simulation here</span>
</pre>
<p>Note that in the current version of Exudyn there is more data stored in render state, which is not used in <tt class="docutils literal">SC.SetRenderState</tt>,
see also theDoc.pdf.</p>
</div>
<div class="section" id="graphics-user-functions-via-python">
<h3>Graphics user functions via Python</h3>
<p>There are some user functions in order to customize drawing:</p>
<ul class="simple">
<li>You can assign graphicsData to the visualization to most bodies, such as rigid bodies in order to change the shape. Graphics can also be imported from files (<tt class="docutils literal">GraphicsDataFromSTLfileTxt</tt>) using the established format STL (STereoLithography or Standard Triangle Language; file format available in nearly all CAD systems).</li>
<li>Some objects, e.g., <tt class="docutils literal">ObjectGenericODE2</tt> or <tt class="docutils literal">ObjectRigidBody</tt>, provide customized a function <tt class="docutils literal">graphicsDataUserFunction</tt>. This user function just returns a list of GraphicsData, see theDoc.pdf. With this function you can change the shape of the body in every step of the computation.</li>
<li>Specifically, the <tt class="docutils literal">graphicsDataUserFunction</tt> in <tt class="docutils literal">ObjectGround</tt> can be used to draw any moving background in the scene.</li>
</ul>
<p>Note that all kinds of <tt class="docutils literal">graphicsDataUserFunction</tt>s need to be called from the main (=computation) process as Python functions may not be called from separate threads (GIL). Therefore, the computation thread is interrupted to execute the <tt class="docutils literal">graphicsDataUserFunction</tt> between two time steps, such that the graphics Python user function can be executed. There is a timeout variable for this interruption of the computation with a warning if scenes get too complicated.</p>
</div>
<div class="section" id="color-rgba-and-alpha-transparency">
<h3>Color, RGBA and alpha-transparency</h3>
<p>Many functions and objects include color information. In order to allow alpha-transparency, all colors contain a list of 4 RGBA values, all values being in the range [0..1]:</p>
<ul class="simple">
<li>red (R) channel</li>
<li>green (G) channel</li>
<li>blue (B) channel</li>
<li>alpha (A) value, representing the so-called <strong>alpha-transparency</strong> (A=0: fully transparent, A=1: solid)</li>
</ul>
<p>E.g., red color with no transparency is obtained by the color=[1,0,0,1]. Color predefinitions are found in <tt class="docutils literal">exudynGraphicsDataUtilities.py</tt>, e.g., <tt class="docutils literal">color4red</tt> or <tt class="docutils literal">color4steelblue</tt> as well a list of 16 colors <tt class="docutils literal">color4list</tt>, which is convenient to be used in a loop creating objects.</p>
</div>
<div class="section" id="camera-following-objects-and-interacting-with-model-view">
<h3>Camera following objects and interacting with model view</h3>
<p>For some models, it may be advantageous to track the translation and/or rotation of certain bodies, e.g., for cars, (wheeled) robots or bicycles.
To do so, the current render state (<tt class="docutils literal">SC.GetRenderState()</tt>, <tt class="docutils literal"><span class="pre">SC.SetRenderState(...)</span></tt>) can be obtained and modified, in order to always follow a certain position.
As this needs to be done during redraw of every frame, it is conveniently done in a graphicsUserFunction, e.g., within the ground body. This is shown in the following example, in which <tt class="docutils literal"><span class="pre">mbs.variables['nTrackNode']</span></tt> is a node number to be tracked:</p>
<pre class="code python literal-block">
<span class="comment single">#mbs.variables['nTrackNode'] contains node number</span>
<span class="keyword">def</span> <span class="name function">UFgraphics</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">objectNum</span><span class="punctuation">):</span>
    <span class="name">n</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">variables</span><span class="punctuation">[</span><span class="literal string single">'nTrackNode'</span><span class="punctuation">]</span>
    <span class="name">p</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">GetNodeOutput</span><span class="punctuation">(</span><span class="name">n</span><span class="punctuation">,</span><span class="name">exu</span><span class="operator">.</span><span class="name">OutputVariableType</span><span class="operator">.</span><span class="name">Position</span><span class="punctuation">,</span>
                          <span class="name">configuration</span><span class="operator">=</span><span class="name">exu</span><span class="operator">.</span><span class="name">ConfigurationType</span><span class="operator">.</span><span class="name">Visualization</span><span class="punctuation">)</span>
    <span class="name">rs</span><span class="operator">=</span><span class="name">SC</span><span class="operator">.</span><span class="name">GetRenderState</span><span class="punctuation">()</span> <span class="comment single">#get current render state</span>
    <span class="name">A</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">array</span><span class="punctuation">(</span><span class="name">rs</span><span class="punctuation">[</span><span class="literal string single">'modelRotation'</span><span class="punctuation">])</span>
    <span class="name">p</span> <span class="operator">=</span> <span class="name">A</span><span class="operator">.</span><span class="name">T</span> <span class="operator">&#64;</span> <span class="name">p</span> <span class="comment single">#transform point into model view coordinates</span>
    <span class="name">rs</span><span class="punctuation">[</span><span class="literal string single">'centerPoint'</span><span class="punctuation">]</span><span class="operator">=</span><span class="punctuation">[</span><span class="name">p</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">],</span><span class="name">p</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">],</span><span class="name">p</span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">]]</span>
    <span class="name">SC</span><span class="operator">.</span><span class="name">SetRenderState</span><span class="punctuation">(</span><span class="name">rs</span><span class="punctuation">)</span>  <span class="comment single">#modify render state</span>
    <span class="keyword">return</span> <span class="punctuation">[]</span>

<span class="comment single">#add object with graphics user function</span>
<span class="name">oGround2</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddObject</span><span class="punctuation">(</span><span class="name">ObjectGround</span><span class="punctuation">(</span><span class="name">visualization</span><span class="operator">=</span>
               <span class="name">VObjectGround</span><span class="punctuation">(</span><span class="name">graphicsDataUserFunction</span><span class="operator">=</span><span class="name">UFgraphics</span><span class="punctuation">)))</span>
<span class="comment single">#.... further code for simulation here</span>
</pre>
</div>
<div class="section" id="solution-viewer">
<h3>Solution viewer</h3>
<p>Exudyn offers a convenient WYSIWYS -- 'What you See is What you Simulate' interface, showing you the computation results during simulation.
If you are running large models, it may be more convenient to watch results after simulation has been finished.
For this, you can use</p>
<ul class="simple">
<li><tt class="docutils literal">interactive.SolutionViewer</tt>, see Section [theDoc.pdf]</li>
<li><tt class="docutils literal">interactive.AnimateModes</tt>, lets you view the animation of computed modes, see Section [theDoc.pdf]</li>
</ul>
<p>The <tt class="docutils literal">SolutionViewer</tt> adds a <tt class="docutils literal">tkinter</tt> interactive dialog, which lets you interact with the model, with the following features:</p>
<ul class="simple">
<li>The SolutionViewer represents a 'Player' for the dynamic solution or a series of static solutions, which is available after simulation if <tt class="docutils literal">solutionSettings.writeSolutionToFile = True</tt></li>
<li>The parameter <tt class="docutils literal">solutionSettings.solutionWritePeriod</tt> represents the time period used to store solutions during dynamic computations.</li>
<li>As soon as 'Run' is pressed, the player runs (and it may be started automatically as well)</li>
<li>In the 'Static' mode, drag the slider 'Solution steps' to view the solution steps</li>
<li>In the 'Continuous run' mode, the player runs in an infinite loop</li>
<li>In the 'One cycle' mode, the player runs from the current position to the end; this is perfectly suited to record series of images for <strong>creating animations</strong>, see theDoc.pdf and works together with the visualization settings dialog.</li>
</ul>
<p>The solution should be loaded with
<tt class="docutils literal"><span class="pre">LoadSolutionFile('coordinatesSolution.txt')</span></tt>, where 'coordinatesSolution.txt' represents the stored solution file,
see</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">exu.SimulationSettings().solutionSettings.coordinatesSolutionFileName</span></tt></li>
</ul>
<p>You can call the <tt class="docutils literal">SolutionViewer</tt> either in the model, or at the command line / IPython to load a previous solution (belonging to the same mbs underlying the solution!):</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.interactive</span> <span class="keyword namespace">import</span> <span class="name">SolutionViewer</span>
<span class="name">sol</span> <span class="operator">=</span> <span class="name">LoadSolutionFile</span><span class="punctuation">(</span><span class="literal string single">'coordinatesSolution.txt'</span><span class="punctuation">)</span>
<span class="name">SolutionViewer</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">sol</span><span class="punctuation">)</span>
</pre>
<p><strong>Alternatively</strong>, if no solution is provided, <tt class="docutils literal">SolutionViewer</tt> tries to reload the solution of the previous simulation that is referred to from <tt class="docutils literal">mbs.sys[simulationSettings]</tt>:</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.interactive</span> <span class="keyword namespace">import</span> <span class="name">SolutionViewer</span>
<span class="name">SolutionViewer</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">)</span>
</pre>
<p>An example for the <tt class="docutils literal">SolutionViewer</tt> is integrated into the <tt class="docutils literal">Examples/</tt> directory, see <tt class="docutils literal">solutionViewerTest.py</tt>.</p>
<p><strong>Note</strong>: The previous function <tt class="docutils literal">AnimateSolution</tt> in <tt class="docutils literal">exudyn.utilities</tt> allows to directly visualize the stored solution for according stored time frames without <tt class="docutils literal">tkinter</tt> (useful for MacOS).</p>
</div>
<div class="section" id="generating-animations">
<h3>Generating animations</h3>
<p>In many dynamics simulations, it is very helpful to create animations in order to better understand the motion of bodies. Specifically, the animation can be used to visualize the model much slower or faster than the model is computed.</p>
<p>Animations are created based on a series of images (frames, snapshots) taken during simulation. It is important, that the current view is used to record these images -- this means that the view should not be changed during the recording of images.
To turn on recording of images during solving, set the following flag to a positive value</p>
<ul class="simple">
<li><tt class="docutils literal">simulationSettings.solutionSettings.recordImagesInterval = 0.01</tt></li>
</ul>
<p>which means, that after every 0.01 seconds of simulation time, an image of the current view is taken and stored in the directory and filename (without filename ending) specified by</p>
<ul class="simple">
<li><tt class="docutils literal">SC.visualizationSettings.exportImages.saveImageFileName = &quot;myFolder/frame&quot;</tt></li>
</ul>
<p>By default, a consecutive numbering is generated for the image, e.g., 'frame0000.png, frame0001.png,...'. Note that the standard file format PNG with ending '.png' uses compression libraries included in glfw, while the alternative TGA format produces '.tga' files which contain raw image data and therefore can become very large.</p>
<p>To create animation files, an external tool FFMPEG is used to efficiently convert a series of images into an animation.
=&gt; see theDoc.pdf !</p>
</div>
<div class="section" id="examples-test-models-and-test-suite">
<h3>Examples, test models and test suite</h3>
<p>The main collection of examples and models is available under</p>
<ul class="simple">
<li><tt class="docutils literal">main/pythonDev/Examples</tt></li>
<li><tt class="docutils literal">main/pythonDev/TestModels</tt></li>
</ul>
<p>You can use these examples to build up your own realistic models of multibody systems.
Very often, these models show the way which already works. Alternative ways may exist, but
sometimes there are limitations in the underlying C++ code, such that they won't work as you expect.</p>
<p>We would like to note that, even that some examples and test models contain comparison to
papers of the literature or analytical solutions, there are many models which may not contain real
mechanical values and these models may not be converged in space or time
(in order to keep running our test suite in less than a minute).</p>
<p>Finally, note that the <tt class="docutils literal">main/pythonDev/TestModels</tt> are often only intended to preserve functionality
in the Python and C++ code (e.g., if global methods are changed), but they should not be misinterpreted as validation of the
implemented methods. The <tt class="docutils literal">TestModels</tt> are used in the Exudyn <strong>TestSuite</strong> <tt class="docutils literal">TestModels/runTestSuite.py</tt>which is run after a full build of Python versions. Output for very version is written
to <tt class="docutils literal">main/pythonDev/TestSuiteLogs</tt> containing the Exudyn version and Python version. At the end of these
files, a summary is included to show if all models completed successfully (which means that a certain error level is achieved, which is rather small and different for the models).
There are also performance tests (e.g., if a certain implementation leads to a significant drop of performance).
However, the output of the performance tests is not stored on github.</p>
<p>We are trying hard to achieve error-free algorithms of physically correct models, but there may always be some errors in the code.</p>
</div>
<div class="section" id="contact-problems">
<h3>Contact problems</h3>
<p>Since Q4 2021 a contact module is available in Exudyn.
This separate module <tt class="docutils literal">GeneralContact</tt> [<strong>still under development, consider with care!</strong>] is highly optimized and implemented with parallelization (multi-threaded) for certain types of contact elements.</p>
<p><img alt="cpic1" src="docs/theDoc/figures/contactTests.png" style="width: 45%;" /> <img alt="cpic2" src="docs/theDoc/figures/contactTests2.jpg" style="width: 45%;" /></p>
<p>[Some tests and examples using <tt class="docutils literal">GeneralContact</tt>]</p>
<p><strong>Note</strong>:</p>
<ul class="simple">
<li><tt class="docutils literal">GeneralContact</tt> is (in most cases) restricted to dynamic simulation (explicit or implicit [<strong>still under development, consider with care!</strong>]) if friction is used; without friction, it also works in the static case</li>
<li>in addition to <tt class="docutils literal">GeneralContact</tt> there are special objects, in particular for rolling and simple 1D contacts, that are available as single objects, cf. <tt class="docutils literal">ObjectConnectorRollingDiscPenalty</tt></li>
<li><tt class="docutils literal">GeneralContact</tt> is recommended to be used for large numbers of contacts, while the single objects are integrated more directly into mbs.</li>
</ul>
<p>Currently, <tt class="docutils literal">GeneralContact</tt> includes:</p>
<ul class="simple">
<li>Sphere-Sphere contact (attached to any marker); may represent circle-circle contact in 2D</li>
<li>Triangles mounted on rigid bodies, in contact with Spheres [only explicit]</li>
<li>ANCFCable2D contacting with spheres (which then represent circles in 2D) [partially implicit, needs revision]</li>
</ul>
<p>For details on the contact formulations, see theDoc.pdf.</p>
</div>
<div class="section" id="removing-convergence-problems-and-solver-failures">
<h3>Removing convergence problems and solver failures</h3>
<p>Nonlinear formulations (such as most multibody systems, especially nonlinear finite elements) cause problems and there is no general nonlinear solver which may reliably and accurately solve such problems.
Tuning solver parameters is at hand of the user.
In general, the Newton solver tries to reduce the error by the factor given in <tt class="docutils literal">simulationSettings.staticSolver.newton.relativeTolerance</tt> (for static solver), which is not possible for very small (or zero) initial residuals. The absolute tolerance is helping out as a lower bound for the error, given in <tt class="docutils literal">simulationSettings.staticSolver.newton.absoluteTolerance</tt> (for static solver), which is by default rather low (1e-10) -- in order to achieve accurate results for small systems or small motion (in mm or mum regime). Increasing this value helps to solve such problems. Nevertheless, you should usually set tolerances as low as possible because otherwise, your solution may become inaccurate.</p>
<p>The following hints shall be followed (also some solver hints).</p>
<ul class="simple">
<li><strong>static solver</strong>: load steps are reduced even if the solution seems to be smooth and less steps are expected; larger number of steps may happen for finer discretization; you may adjust (increase) <tt class="docutils literal">.newton.relativeTolerance</tt> / <tt class="docutils literal">.newton.absoluteTolerance</tt> in static solver or in time integration to resolve such problems, but check if solution achieves according accuracy</li>
<li><strong>static solver</strong>: load steps are reduced significantly for highly nonlinear problems; solver repeatedly writes that steps are reduced =&gt; try to use <tt class="docutils literal">loadStepGeometric</tt> and use a large <tt class="docutils literal">loadStepGeometricRange</tt>: this allows to start with very small loads in which the system is nearly linear (e.g. for thin strings or belts under gravity).</li>
<li><strong>static solver</strong>: in case that your system is (nearly) kinematic, a static solution can be achieved using <tt class="docutils literal">stabilizerODE2term</tt>, which adds mass-proportional stiffness terms during load steps &lt; 1.</li>
<li>very small loads or even <strong>zero loads</strong> do not converge: <tt class="docutils literal">SolveDynamic</tt> or <tt class="docutils literal">SolveStatic</tt> <strong>terminated due to errors</strong></li>
</ul>
<blockquote>
<div class="line-block">
<div class="line">=&gt;  the reason is the nonlinearity of formulations (nonlinear kinematics, nonlinear beam, etc.) and round off errors, which restrict Newton to achieve desired tolerances</div>
<div class="line">=&gt;  adjust (increase) <tt class="docutils literal">.newton.relativeTolerance</tt> / <tt class="docutils literal">.newton.absoluteTolerance</tt> in static solver or in time integration</div>
<div class="line">=&gt;  in many cases, especially for static problems, the <tt class="docutils literal">.newton.newtonResidualMode = 1</tt> evaluates the increments; the nonlinear problems is assumed to be converged, if increments are within given absolute/relative tolerances; this also works usually better for kinematic solutions</div>
</div>
</blockquote>
<ul class="simple">
<li>for <strong>discontinuous problems</strong>: try to adjust solver parameters; especially the <tt class="docutils literal">discontinuous.iterationTolerance</tt> and <tt class="docutils literal">discontinuous.maxIterations</tt>; try to make smaller load or time steps in order to resolve switching points of contact or friction; generalized alpha solvers may cause troubles when reducing step sizes =&gt; use TrapezoidalIndex2 solver</li>
<li>if you see further problems, please post them (including relevant example) at the Exudyn github page!</li>
</ul>
</div>
<div class="section" id="performance-and-ways-to-speed-up-computations">
<h3>Performance and ways to speed up computations</h3>
<p>Multibody dynamics simulation should be accurate and reliable on the one hand side. Most solver settings are such that they lead to comparatively reliable results.
However, in some cases there is a significant possibility for speeding up computations, which are described in the following list. Not all recommendations may apply to your models.</p>
<p>The following examples refer to <tt class="docutils literal">simulationSettings = exu.SimulationSettings()</tt>.
In general, to see where CPU time is lost, use the option turn on <tt class="docutils literal">simulationSettings.displayComputationTime = True</tt> to see which parts of the solver need most of the time (deactivated in exudynFast versions!).</p>
<p>To activate the Exudyn C++ versions without range checks, which may be approx. 30 percent faster in some situations, use the following code snippet before first import of <tt class="docutils literal">exudyn</tt>:</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">sys</span>
<span class="name">sys</span><span class="operator">.</span><span class="name">exudynFast</span> <span class="operator">=</span> <span class="keyword constant">True</span> <span class="comment single">#this variable is used to signal to load the fast exudyn module</span>
<span class="keyword namespace">import</span> <span class="name namespace">exudyn</span> <span class="keyword">as</span> <span class="name namespace">exu</span>
</pre>
<p>The faster versions are available for all release versions, but only for some <tt class="docutils literal">.dev1</tt> development versions (Python 3.10), which can be determined by trying <tt class="docutils literal">import exudyn.exudynCPPfast</tt>.</p>
<p>However, there are many <strong>ways to speed up Exudyn in general</strong>:</p>
<ul class="simple">
<li>for models with more than 50 coordinates, switching to sparse solvers might greatly improve speed: <tt class="docutils literal">simulationSettings.linearSolverType = exu.LinearSolverType.EigenSparse</tt></li>
<li>try to avoid Python functions or try to speed up Python functions</li>
<li>instead of user functions in objects or loads (computed in every iteration), some problems would also work if these parameters are only updated in <tt class="docutils literal"><span class="pre">mbs.SetPreStepUserFunction(...)</span></tt></li>
<li>Python user functions can be speed up using the Python numba package, using <tt class="docutils literal">&#64;jit</tt> in front of functions (for more options, see <a class="reference external" href="https://numba.pydata.org/numba-doc/dev/user/index.html">https://numba.pydata.org/numba-doc/dev/user/index.html</a>); Example given in <tt class="docutils literal">Examples/springDamperUserFunctionNumbaJIT.py</tt> showing speedups of factor 4; more complicated Python functions may see speedups of 10 - 50</li>
<li>for <strong>discontinuous problems</strong>, try to adjust solver parameters; especially the discontinuous.iterationTolerance which may be too tight and cause many iterations; iterations may be limited by discontinuous.maxIterations, which at larger values solely multiplies the computation time with a factor if all iterations are performed</li>
<li>For multiple computations / multiple runs of Exudyn (parameter variation, optimization, compute sensitivities), you can use the processing sub module of Exudyn to parallelize computations and achieve speedups proporional to the number of cores/threads of your computer; specifically using the <tt class="docutils literal">multiThreading</tt> option or even using a cluster (using <tt class="docutils literal">dispy</tt>, see <tt class="docutils literal"><span class="pre">ParameterVariation(...)</span></tt> function)</li>
<li>In case of multiprocessing and cluster computing, you may see a very high CPU usage of &quot;Antimalware Service Executable&quot;, which is the Microsoft Defender Antivirus; you can turn off such problems by excluding <tt class="docutils literal">python.exe</tt> from the defender (on your own risk!) in your settings:</li>
</ul>
<blockquote>
Settings =&gt; Update &amp; Security =&gt; Windows Security =&gt; Virus &amp; threat protection settings =&gt; Manage settings =&gt; Exclusions =&gt; Add or remove exclusions</blockquote>
<p><strong>Possible speed ups for dynamic simulations</strong>:</p>
<ul class="simple">
<li>for implicit integration, turn on <strong>modified Newton</strong>, which updates jacobians only if needed: <tt class="docutils literal">simulationSettings.timeIntegration.newton.useModifiedNewton = True</tt></li>
<li>use <strong>multi-threading</strong>: <tt class="docutils literal">simulationSettings.parallel.numberOfThreads = ...</tt>, depending on the number of cores (larger values usually do not help); improves greatly for contact problems, but also for some objects computed in parallel; will improve significantly in future</li>
<li>decrease number of steps (<tt class="docutils literal">simulationSettings.timeIntegration.numberOfSteps = int(tEnd/h)</tt>) by increasing the step size h if not needed for accuracy reasons; not that in general, the solver will reduce steps in case of divergence, but not for accuracy reasons, which may still lead to divergence if step sizes are too large</li>
<li>switch off measuring computation time, if not needed: <tt class="docutils literal">simulationSettings.displayComputationTime = False</tt></li>
<li>try to switch to <strong>explicit solvers</strong>, if problem has no constraints and if problem is not stiff</li>
<li>try to have <strong>constant mass matrices</strong> (see according objects, which have constant mass matrices; e.g. rigid bodies using RotationVector Lie group node have constant mass matrix)</li>
<li>for explicit integration, set <tt class="docutils literal">computeEndOfStepAccelerations = False</tt>, if you do not need accurate evaluation of accelerations at end of time step (will then be taken from beginning)</li>
<li>for explicit integration, set <tt class="docutils literal">explicitIntegration.computeMassMatrixInversePerBody=True</tt>, which avoids factorization and back substitution, which may speed up computations with many bodies / particles</li>
<li>if you are sure that your mass matrix is constant, set <tt class="docutils literal">simulationSettings.timeIntegration.reuseConstantMassMatrix = True</tt>; check results!</li>
<li>check that <tt class="docutils literal">simulationSettings.timeIntegration.simulateInRealtime = False</tt>; if set True, it breaks down simulation to real time</li>
<li>do not record images, if not needed: <tt class="docutils literal">simulationSettings.solutionSettings.recordImagesInterval = <span class="pre">-1</span></tt></li>
<li>in case of bad convergence, decreasing the step size might also help; check also other flags for adaptive step size and for Newton</li>
<li>use <tt class="docutils literal">simulationSettings.timeIntegration.verboseMode = 1</tt>; larger values create lots of output which drastically slows down</li>
<li>use <tt class="docutils literal">simulationSettings.timeIntegration.verboseModeFile = 0</tt>, otherwise output written to file</li>
<li>adjust <tt class="docutils literal">simulationSettings.solutionSettings.sensorsWritePeriod</tt> to avoid time spent on writing sensor files</li>
<li>use <tt class="docutils literal">simulationSettings.timeIntegration.writeSolutionToFile = False</tt>, otherwise much output may be written to file;</li>
<li>if solution file is needed, adjust <tt class="docutils literal">simulationSettings.solutionSettings.solutionWritePeriod</tt> to larger values and also adjust <tt class="docutils literal">simulationSettings.solutionSettings.outputPrecision</tt>, e.g., to 6, in order to avoid larger files; also adjust <tt class="docutils literal">simulationSettings.solutionSettings.exportVelocities = False</tt> and <tt class="docutils literal">simulationSettings.solutionSettings.exportAccelerations = False</tt> to avoid large output files</li>
</ul>
</div>
</div>
<div class="section" id="advanced-topics">
<h2>Advanced topics</h2>
<p>This section covers some advanced topics, which may be only relevant for a smaller group of people.
Functionality may be extended but also removed in future</p>
</div>
<div class="section" id="openvr">
<h2>OpenVR</h2>
<p>The general open source libraries from Valve, see</p>
<blockquote>
<a class="reference external" href="https://github.com/ValveSoftware/openvr">https://github.com/ValveSoftware/openvr</a></blockquote>
<p>have been linked to Exudyn . In order to get OpenVR fully integrated, you need to run <tt class="docutils literal">setup.py</tt> Exudyn with the <tt class="docutils literal"><span class="pre">--openvr</span></tt> flag. For general installation instructions, see theDoc.pdf.</p>
<p>Running OpenVR either requires an according head mounted display (HMD) or a virtualization using, e.g., Riftcat 2 to use a mobile phone with an according adapter. Visualization settings are available in <tt class="docutils literal">interactive.openVR</tt>, but need to be considered with care.
An example is provided in <tt class="docutils literal">openVRengine.py</tt>, showing some optimal flags like locking the model rotation, zoom or translation.</p>
<p>Everything is experimental, but contributions are welcome!</p>
</div>
<div class="section" id="interaction-with-other-codes">
<h2>Interaction with other codes</h2>
<p>Interaction with other codes and computers (E.g., MATLAB or other C++ codes, or other Python versions)
is possible.
To connect to any other code, it is convenient to use a TCP/IP connection. This is enabled via
the <tt class="docutils literal">exudyn.utilities</tt> functions</p>
<ul class="simple">
<li><tt class="docutils literal">CreateTCPIPconnection</tt></li>
<li><tt class="docutils literal">TCPIPsendReceive</tt></li>
<li><tt class="docutils literal">CloseTCPIPconnection</tt></li>
</ul>
<dl class="docutils">
<dt>Basically, data can be transmitted in both directions, e.g., within a preStepUserFunction. In Examples, you can find</dt>
<dd>TCPIPexudynMatlab.py which shows a basic example for such a connectivity.</dd>
</dl>
</div>
<div class="section" id="ros">
<h2>ROS</h2>
<p>Basic interaction with ROS has been tested. However, make sure to use Python 3, as there is (and will never be) a Python 2
support for Exudyn .</p>
</div>
<div class="section" id="c-code">
<h2>C++ Code</h2>
<p>This section covers some information on the C++ code. For more information see the Open source code and use doxygen.</p>
<p>Exudyn was developed for the efficient simulation of flexible multi-body systems. Exudyn was designed for rapid implementation and testing of new formulations and algorithms in multibody systems, whereby these algorithms can be easily implemented in efficient C++ code. The code is applied to industry-related research projects and applications.</p>
<div class="section" id="focus-of-the-c-code">
<h3>Focus of the C++ code</h3>
<p>The code focuses on four principles, starting with highest priority:</p>
<ul class="simple">
<li>developer-friendly</li>
<li>error minimization</li>
<li>user-friendliness</li>
<li>efficiency</li>
</ul>
<p>The focus is therefore on:</p>
<ul class="simple">
<li>A developer-friendly basic structure regarding the C++ class library and the possibility to add new components.</li>
<li>The basic libraries are slim, but extensively tested; only the necessary components are available</li>
<li>Complete unit tests are added to new program parts during development; for more complex processes, tests are available in Python</li>
<li>In order to implement the sometimes difficult formulations and algorithms without errors, error avoidance is always prioritized.</li>
<li>To generate efficient code, classes for parallelization (vectorization and multithreading) are provided. We live the principle that parallelization takes place on multi-core processors with a central main memory, and thus an increase in efficiency through parallelization is only possible with small systems, as long as the program runs largely in the cache of the processor cores. Vectorization is tailored to SIMD commands as they have Intel processors, but could also be extended to GPGPUs in the future.</li>
<li>The user interface (Python) provides a nearly 1:1 image of the system and the processes running in it, which can be controlled with the extensive possibilities of Python.</li>
</ul>
</div>
<div class="section" id="c-code-structure">
<h3>C++ Code structure</h3>
<p>The following <strong>entry points</strong> into the C++ code can be found:</p>
<ul>
<li><p class="first">Python -- C++: the creation of the module <tt class="docutils literal">exudyn</tt> is found in:</p>
<blockquote>
<p><tt class="docutils literal">main/src/Pymodules/PybindModule.cpp</tt></p>
</blockquote>
</li>
</ul>
<blockquote>
it includes large header files, which are automatically created for binding C++ code with Python.%blank line needed for .rst:</blockquote>
<ul>
<li><p class="first">The object factory for creation of items (calling <tt class="docutils literal"><span class="pre">mbs.AddNode(...)</span></tt> and similar):</p>
<blockquote>
<p><tt class="docutils literal">main/src/Main/MainObjectFactory.h / .cpp</tt></p>
</blockquote>
</li>
<li><p class="first">Using the VisualStudio <tt class="docutils literal">.sln</tt> file and using the Debug mode allows you to smoothly walk from Python to C++ code (though that this takes some time to start up and it does not work always; and it does not work for graphics if it runs in a separate thread).</p>
</li>
</ul>
<p>The functionality of the code is mainly based on systems (MainSystem and CSystem), items and solvers representing the multibody system or similar physical systems to be simulated. Parts of the core structure of Exudyn are:</p>
<ul class="simple">
<li>CSystem / MainSystem: a multibody system which consists of nodes, objects, markers, loads, etc.</li>
<li>SystemContainer: holds a set of systems; connects to visualization (container)</li>
<li>items: node, (computational) object, marker, load, sensor</li>
<li>computational objects: efficient objects for computation = bodies, connectors, connectors, loads, nodes, ...</li>
<li>visualization objects: interface between computational objects and 3D graphics</li>
<li>main (manager) objects: do all tasks (e.g. interface to visualization objects, GUI, Python, ...) which are not needed during computation</li>
<li>static solver, kinematic solver, time integration</li>
<li>Python interface via pybind11; items are accessed with a dictionary interface; system structures and settings read/written by direct access to the structure (e.g. SimulationSettings, VisualizationSettings)</li>
<li>interfaces to linear solvers; future: optimizer, eigenvalue solver, ... (mostly external or in Python)</li>
<li><strong>autogenerated</strong>: this folder in <tt class="docutils literal">main/src</tt> contains many item definitions as well as other interface files; they are all automatically generated by some Python code and should not be changed manually as they will be overwritten.</li>
</ul>
</div>
<div class="section" id="c-code-modules">
<h3>C++ Code: Modules</h3>
<p>The following internal modules are used, which are represented by directories in <tt class="docutils literal">main/src</tt>:</p>
<ul class="simple">
<li>Autogenerated: item (nodes, objects, markers and loads) classes split into main (management, Python connection), visualization and computation</li>
<li>Graphics: a general data structure for 2D and 3D graphical objects and a tiny openGL visualization; linkage to GLFW</li>
<li>Linalg: Linear algebra with vectors and matrices; separate classes for small vectors (SlimVector), large vectors (Vector and ResizableVector), vectors without copying data (LinkedDataVector), and vectors with constant size (ConstVector)</li>
<li>Main: mainly contains SystemContainer, System and ObjectFactory</li>
<li>Objects: contains the implementation part of the autogenerated items</li>
<li>Pymodules: manually created libraries for linkage to Python via pybind; remaining linking to Python is located in autogenerated folder</li>
<li>pythonGenerator: contains Python files for automatic generation of C++ interfaces and Python interfaces of items;</li>
<li>Solver: contains all solvers for solving a CSystem</li>
<li>System: contains core item files (e.g., MainNode, CNode, MainObject, CObject, ...)</li>
<li>Tests: files for testing of internal linalg (vector/matrix), data structure libraries (array, etc.) and functions</li>
<li>Utilities: array structures for administrative/managing tasks (indexes of objects ... bodies, forces, connectors, ...); basic classes with templates and definitions</li>
</ul>
<p>The following main external libraries are linked to Exudyn:</p>
<ul class="simple">
<li>LEST: for testing of internal functions (e.g. linalg)</li>
<li>GLFW: 3D graphics with openGL; cross-platform capabilities</li>
<li>Eigen: linear algebra for large matrices, linear solvers, sparse matrices and link to special solvers</li>
<li>pybind11: linking of C++ to Python</li>
</ul>
</div>
<div class="section" id="code-style-and-conventions">
<h3>Code style and conventions</h3>
<p>This section provides general coding rules and conventions, partly applicable to the C++ and Python parts of the code. Many rules follow common conventions (e.g., google code style, but not always -- see notation):</p>
<ul class="simple">
<li>write simple code (no complicated structures or uncommon coding)</li>
<li>write readable code (e.g., variables and functions with names that represent the content or functionality; AVOID abbreviations)</li>
<li>put a header in every file, according to Doxygen format</li>
<li>put a comment to every (global) function, member function, data member, template parameter</li>
<li>ALWAYS USE curly brackets for single statements in 'if', 'for', etc.; example: if (i&lt;n) i += 1;</li>
<li>use Doxygen-style comments (use '//!' Qt style and '&#64; date' with '&#64;' instead of '' for commands)</li>
<li>use Doxygen (with preceeding '&#64;') 'test' for tests, 'todo' for todos and 'bug' for bugs</li>
<li>USE 4-spaces-tab</li>
<li>use C++11 standards when appropriate, but not exhaustively</li>
<li>ONE class ONE file rule (except for some collectors of single implementation functions)</li>
<li>add complete unit test to every function (every file has link to LEST library)</li>
<li>avoid large classes (&gt;30 member functions; &gt; 15 data members)</li>
<li>split up god classes (&gt;60 member functions)</li>
<li>mark changed code with your name and date</li>
<li>REPLACE tabs by spaces: Extras-&gt;Options-&gt;C/C++-&gt;Tabstopps: tab stopp size = 4 (=standard) +  KEEP SPACES=YES</li>
</ul>
</div>
<div class="section" id="notation-conventions">
<h3>Notation conventions</h3>
<p>The following notation conventions are applied (<strong>no exceptions!</strong>):</p>
<ul class="simple">
<li>use lowerCamelCase for names of variables (including class member variables), consts, c-define variables, ...; EXCEPTION: for algorithms following formulas, e.g., f = M*q_tt + K*q, GBar, ...</li>
<li>use UpperCamelCase for functions, classes, structs, ...</li>
<li>Special cases for CamelCase (with some exceptions that happened in the past ...):</li>
<li>continue upper case after upper case abbreviations in case of <strong>functions or classes</strong>: 'ODESystem', 'Point2DClass', 'ANCFCable2D', 'ANCFALE', 'ComputeODE1Equations', ... (this is not always nice to read, but has become a standard and will be further used!)</li>
<li>for variables and class member variables continue <strong>lower case</strong>: 'nODE1variables', 'dim2Dspecial', 'ANCFsize'</li>
<li>abbreviations at beginning of expressions: for functions or classes use <tt class="docutils literal">ODEComputeCoords()</tt>, for variables avoid 'ODE' at beginning: use 'nODE' or write 'odeCoordinates'</li>
<li>'[...]Init' ... in arguments, for initialization of variables; e.g. 'valueInit' for initialization of member variable 'value'</li>
<li>use American English throughout: Visualization, etc.</li>
<li>AVOID consecutive capitalized words, e.g., avoid 'ODEAE'</li>
<li>do not use '_' within variable or function names; exception: derivatives</li>
<li>use name which exactly describes the function/variable: 'numberOfItems' instead of 'size' or 'l'</li>
<li>examples for variable names: secondOrderSize, massMatrix, mThetaTheta</li>
<li>examples for function/class names: <tt class="docutils literal">SecondOrderSize</tt>, <tt class="docutils literal">EvaluateMassMatrix</tt>, <tt class="docutils literal">Position(const Vector3D\&amp; localPosition)</tt></li>
<li>use the Get/Set...() convention if data is retrieved from a class (Get) or something is set in a class (Set); Use <tt class="docutils literal">const T\&amp; <span class="pre">Get()/T\&amp;</span> Get</tt> if direct access to variables is needed; Use Get/Set for pybind11</li>
<li>example Get/Set: <tt class="docutils literal">Real* GetDataPointer()</tt>, <tt class="docutils literal"><span class="pre">Vector::SetAll(Real)</span></tt>, <tt class="docutils literal">GetTransposed()</tt>, <tt class="docutils literal"><span class="pre">SetRotationalParameters(...)</span></tt>, <tt class="docutils literal"><span class="pre">SetColor(...)</span></tt>, ...</li>
<li>use 'Real' instead of double or float: for compatibility, also for AVX with SP/DP</li>
<li>use 'Index' for array/vector size and index instead of size_t or int</li>
<li>item: object, node, marker, load: anything handled within the computational/visualization systems</li>
<li>Do not use numbers (3 for 3D or any other number which represents, e.g., the number of rotation parameters). Use const Index or constexpr to define constants.</li>
</ul>
</div>
<div class="section" id="no-abbreviations-rule">
<h3>No-abbreviations-rule</h3>
<p>The code uses a <strong>minimum set of abbreviations</strong>; however, the following abbreviation rules are used throughout:
In general: DO NOT ABBREVIATE function, class or variable names: GetDataPointer() instead of GetPtr(); exception: cnt, i, j, k, x or v in cases where it is really clear (short, 5-line member functions).</p>
<p><strong>Exceptions</strong> to the NO-ABBREVIATIONS-RULE, see also hyperref[sec:listOfAbbreviations]underlineList of Abbreviations: %no section number!!!: theDoc.pdf</p>
<ul class="simple">
<li>ODE</li>
<li>ODE2: marks parts related to second order differential equations (SOS2, EvalF2 in HOTINT)</li>
<li>ODE1: marks parts related to first order differential equations (ES, EvalF in HOTINT)</li>
<li>AE; note: using the term 'AEcoordinates' for 'algebraicEquationsCoordinates'</li>
<li>'C[...]' ... Computational, e.g. for ComputationalNode ==&gt; use 'CNode'</li>
<li>mbs</li>
<li>min, max</li>
<li>abs, rel</li>
<li>trig</li>
<li>quad</li>
<li>RHS</li>
<li>LHS</li>
<li>EP</li>
<li>Rxyz%: consecutive rotations around x, y and z-axis (Tait-Bryan rotations);</li>
<li>coeffs</li>
<li>pos</li>
<li>T66; based on 6times 6 matrix transformations</li>
<li>write time derivatives with underscore: _t, _tt; example: Position_t, Position_tt, ...</li>
<li>write space-wise derivatives ith underscore: _x, _xx, _y, ...</li>
<li>if a scalar, write coordinate derivative with underscore: _q, _v (derivative w.r.t. velocity coordinates)</li>
<li>for components, elements or entries of vectors, arrays, matrices: use 'item' throughout</li>
<li>'[...]Init' ... in arguments, for initialization of variables; e.g. 'valueInit' for initialization of member variable 'value'</li>
</ul>
</div>
<div class="section" id="implementation-of-new-computational-items-in-c">
<h3>Implementation of new computational items in C++</h3>
<p>This section should sketch which changes will be needed to integrate new C++ items.
In general, it is recommended to first start with a Python implementation with user functions based on
<tt class="docutils literal"><span class="pre">NodeGeneric...</span></tt>, <tt class="docutils literal"><span class="pre">ObjectGeneric...</span></tt>, <tt class="docutils literal">ObjectConnectorCoordinateVector</tt> for constraints and
any suitable connector for new nodes or objects. New sensors can be based on the <tt class="docutils literal">SensorUserFunction</tt>.</p>
<p>If such an implementation is successful, but too slow, a C++ implementation can be considered.
In the following, two use cases are shown, which show the simplicity of the procedure:</p>
<ul class="simple">
<li><strong>Case 1</strong>: user object (body):</li>
</ul>
<blockquote>
It is recommended to first search for a body with a similar behavior.
Copy the definition of such an object inside the file <tt class="docutils literal">objectDefinition.py</tt> and edit the according lines.
There is not much description of
this file yet (except from the first lines of the file), as it will be transformed into another format in the future.
Basically, you need to edit the interface, which contains parameters (which are linked to Python) and functions,
which go to the header file.
When you finished editing, run <tt class="docutils literal">pythonAutoGenerateObjects.py</tt>. This generates the header file in <tt class="docutils literal">src/autogenerated</tt>but also adds description to some docs files and adds the <tt class="docutils literal">pybind11</tt> interface.
Now copy the implementation (<tt class="docutils literal">.cpp</tt>) file of the same connector from which you copied from and rename and edit all functions.
For the body</blockquote>
<ul class="simple">
<li><tt class="docutils literal">ComputeMassMatrix</tt>: computes the mass matrix either in sparse or dense mode; this function is performance-critical if the mass matrix is non-constant</li>
<li><tt class="docutils literal">ComputeODE2LHS</tt>: computes the LHS generalized forces of the body; this function is performance-critical</li>
<li><tt class="docutils literal">GetAccessFunctionTypes</tt>: specifies, which access functions are available in <tt class="docutils literal"><span class="pre">GetAccessFunctionBody(...)</span></tt></li>
<li><tt class="docutils literal">GetAccessFunctionBody</tt>: needs to compute functions for 'access' to the body, in the sense that e.g. forces or torques can be applied.</li>
<li><tt class="docutils literal">GetAvailableJacobians</tt>: shall return the flags which jacobians of <tt class="docutils literal">ComputeODE2LHS</tt> need to be computed and which are available as functions; binary flags added up</li>
<li><tt class="docutils literal">GetOutputVariableBody</tt>: function needs to implement the output variables, such as position, acceleration, forces, etc. as defined in <tt class="docutils literal">GetOutputVariableTypes()</tt></li>
<li><tt class="docutils literal">HasConstantMassMatrix</tt>: specifies, if mass matrix is constant</li>
<li><tt class="docutils literal">GetNumberOfNodes</tt>: number of nodes of object</li>
<li><tt class="docutils literal">GetODE2Size</tt>: total number of ODE2 coordinates</li>
<li><tt class="docutils literal">GetType</tt>: some flags for objects, such as <tt class="docutils literal">Body</tt>, <tt class="docutils literal">SingleNoded</tt>, <tt class="docutils literal">SuperElement</tt>, ...; these flags are needed for connectivity and special treatment in the system</li>
<li><tt class="docutils literal">GetPosition, GetVelocity, ...</tt>: provide this functions as far as possible; rigid bodies need to provide positions and rotation matrix, as well as velocity and angular velocity for markers; if functions do not exist, some marker or sensor functions may fail</li>
<li>...   possibly some helper functions, which you should implement for the functionality of your object.</li>
<li><strong>Case 2</strong>: user connector:</li>
</ul>
<blockquote>
It is recommended to search for a connector with similar behavior; first check, if you would like to implement
an algebraic constraint or a spring-damper-like connector.
Again, copy a similar connector in <tt class="docutils literal">objectDefinition.py</tt> and edit the according lines.
When you finished editing, run <tt class="docutils literal">pythonAutoGenerateObjects.py</tt> and make a copy of the copied implementation (<tt class="docutils literal">.cpp</tt>) file.
The implementation file usually consists of</blockquote>
<ul class="simple">
<li><tt class="docutils literal">ComputeODE2LHS</tt>: this function shall compute the LHS generalized forces on the two marker objects</li>
<li><tt class="docutils literal">ComputeJacobianODE2_ODE2</tt>: computes the <tt class="docutils literal">GetAvailableJacobians()</tt> is not providing any '..._function' flag, which indicates that these jacobians are available as function</li>
<li><tt class="docutils literal">GetOutputVariableConnector</tt>: this function needs to compute all output variables as given in <tt class="docutils literal">GetOutputVariableTypes()</tt></li>
<li>...   possibly some helper functions, which you should implement for the functionality of your object.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="tutorial">
<h1>Tutorial</h1>
<p>This section will show:</p>
<ul class="simple">
<li>A basic tutorial for a 1D mass and spring-damper with initial displacements, shortest possible model with practically no special settings</li>
<li>A more advanced rigid-body model, including 3D rigid bodies and revolute joints</li>
<li>Links to examples section</li>
</ul>
<p>A large number of examples, some of them quite advanced, can be found in:</p>
<blockquote>
<tt class="docutils literal">main/pythonDev/Examples</tt><tt class="docutils literal">main/pythonDev/TestModels</tt></blockquote>
<div class="section" id="mass-spring-damper-tutorial">
<h2>Mass-Spring-Damper tutorial</h2>
<p>The python source code of the first tutorial can be found in the file:</p>
<blockquote>
<tt class="docutils literal">main/pythonDev/Examples/springDamperTutorial.py</tt></blockquote>
<p>This tutorial will set up a mass point and a spring damper, dynamically compute the solution and evaluate the reference solution.</p>
<p>We import the exudyn library and the interface for all nodes, objects, markers, loads and sensors:</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">exudyn</span> <span class="keyword">as</span> <span class="name namespace">exu</span>
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.itemInterface</span> <span class="keyword namespace">import</span> <span class="operator">*</span>
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword">as</span> <span class="name namespace">np</span> <span class="comment single">#for postprocessing</span>
</pre>
<p>Next, we need a <tt class="docutils literal">SystemContainer</tt>, which contains all computable systems and add a new MainSystem <tt class="docutils literal">mbs</tt>.
Per default, you always should name your system 'mbs' (multibody system), in order to copy/paste code parts from other examples, tutorials and other projects:</p>
<pre class="code python literal-block">
<span class="name">SC</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">SystemContainer</span><span class="punctuation">()</span>
<span class="name">mbs</span> <span class="operator">=</span> <span class="name">SC</span><span class="operator">.</span><span class="name">AddSystem</span><span class="punctuation">()</span>
</pre>
<p>In order to check, which version you are using, you can printout the current Exudyn version. This version is in line with the issue tracker and marks the number of open/closed issues added to Exudyn :</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'EXUDYN version='</span><span class="operator">+</span><span class="name">exu</span><span class="operator">.</span><span class="name">__version__</span><span class="punctuation">)</span>
</pre>
<p>Using the powerful Python language, we can define some variables for our problem, which will also be used for the analytical solution:</p>
<pre class="code python literal-block">
<span class="name">L</span><span class="operator">=</span><span class="literal number float">0.5</span>               <span class="comment single">#reference position of mass</span>
<span class="name">mass</span> <span class="operator">=</span> <span class="literal number float">1.6</span>          <span class="comment single">#mass in kg</span>
<span class="name">spring</span> <span class="operator">=</span> <span class="literal number integer">4000</span>       <span class="comment single">#stiffness of spring-damper in N/m</span>
<span class="name">damper</span> <span class="operator">=</span> <span class="literal number integer">8</span>          <span class="comment single">#damping constant in N/(m/s)</span>
<span class="name">f</span> <span class="operator">=</span><span class="literal number integer">80</span>               <span class="comment single">#force on mass</span>
</pre>
<p>For the simple spring-mass-damper system, we need initial displacements and velocities:</p>
<pre class="code python literal-block">
<span class="name">u0</span><span class="operator">=-</span><span class="literal number float">0.08</span>            <span class="comment single">#initial displacement</span>
<span class="name">v0</span><span class="operator">=</span><span class="literal number integer">1</span>                <span class="comment single">#initial velocity</span>
<span class="name">x0</span><span class="operator">=</span><span class="name">f</span><span class="operator">/</span><span class="name">spring</span>         <span class="comment single">#static displacement</span>
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'resonance frequency = '</span><span class="operator">+</span><span class="name builtin">str</span><span class="punctuation">(</span><span class="name">np</span><span class="operator">.</span><span class="name">sqrt</span><span class="punctuation">(</span><span class="name">spring</span><span class="operator">/</span><span class="name">mass</span><span class="punctuation">)))</span>
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'static displacement = '</span><span class="operator">+</span><span class="name builtin">str</span><span class="punctuation">(</span><span class="name">x0</span><span class="punctuation">))</span>
</pre>
<p>We first need to add nodes, which provide the coordinates (and the degrees of freedom) to the system.
The following line adds a 3D node for 3D mass point (Note: Point is an abbreviation for NodePoint, defined in <tt class="docutils literal">itemInterface.py</tt>.):</p>
<pre class="code python literal-block">
<span class="name">n1</span><span class="operator">=</span><span class="name">mbs</span><span class="operator">.</span><span class="name">AddNode</span><span class="punctuation">(</span><span class="name">Point</span><span class="punctuation">(</span><span class="name">referenceCoordinates</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                     <span class="name">initialCoordinates</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">u0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                     <span class="name">initialVelocities</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">v0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]))</span>
</pre>
<p>Here, <tt class="docutils literal">Point</tt> (=<tt class="docutils literal">NodePoint</tt>) is a Python class, which takes a number of arguments defined in the reference manual. The arguments here are <tt class="docutils literal">referenceCoordinates</tt>, which are the coordinates for which the system is defined. The initial configuration is given by <tt class="docutils literal">referenceCoordinates + initialCoordinates</tt>, while the initial state additionally gets <tt class="docutils literal">initialVelocities</tt>.
The command <tt class="docutils literal"><span class="pre">mbs.AddNode(...)</span></tt> returns a <tt class="docutils literal">NodeIndex n1</tt>, which basically contains an integer, which can only be used as node number. This node number will be used lateron to use the node in the object or in the marker.</p>
<p>While <tt class="docutils literal">Point</tt> adds 3 unknown coordinates to the system, which need to be solved, we also can add ground nodes, which can be used similar to nodes, but they do not have unknown coordinates -- and therefore also have no initial displacements or velocities. The advantage of ground nodes (and ground bodies) is that no constraints are needed to fix these nodes.
Such a ground node is added via:</p>
<pre class="code python literal-block">
<span class="name">nGround</span><span class="operator">=</span><span class="name">mbs</span><span class="operator">.</span><span class="name">AddNode</span><span class="punctuation">(</span><span class="name">NodePointGround</span><span class="punctuation">(</span><span class="name">referenceCoordinates</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]))</span>
</pre>
<p>In the next step, we add an object (sec:programStructure.), which provides equations for coordinates. The <tt class="docutils literal">MassPoint</tt> needs at least a mass (kg) and a node number to which the mass point is attached. Additionally, graphical objects could be attached:</p>
<pre class="code python literal-block">
<span class="name">massPoint</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddObject</span><span class="punctuation">(</span><span class="name">MassPoint</span><span class="punctuation">(</span><span class="name">physicsMass</span> <span class="operator">=</span> <span class="name">mass</span><span class="punctuation">,</span> <span class="name">nodeNumber</span> <span class="operator">=</span> <span class="name">n1</span><span class="punctuation">))</span>
</pre>
<p>In order to apply constraints and loads, we need markers. These markers are used as local positions (and frames), where we can attach a constraint lateron. In this example, we work on the coordinate level, both for forces as well as for constraints.
Markers are attached to the according ground and regular node number, additionally using a coordinate number (0 ... first coordinate):</p>
<pre class="code python literal-block">
<span class="name">groundMarker</span><span class="operator">=</span><span class="name">mbs</span><span class="operator">.</span><span class="name">AddMarker</span><span class="punctuation">(</span><span class="name">MarkerNodeCoordinate</span><span class="punctuation">(</span><span class="name">nodeNumber</span><span class="operator">=</span> <span class="name">nGround</span><span class="punctuation">,</span>
                                                <span class="name">coordinate</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">))</span>
<span class="comment single">#marker for springDamper for first (x-)coordinate:</span>
<span class="name">nodeMarker</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddMarker</span><span class="punctuation">(</span><span class="name">MarkerNodeCoordinate</span><span class="punctuation">(</span><span class="name">nodeNumber</span><span class="operator">=</span> <span class="name">n1</span><span class="punctuation">,</span>
                                                <span class="name">coordinate</span> <span class="operator">=</span> <span class="literal number integer">0</span><span class="punctuation">))</span>
</pre>
<p>This means that loads can be applied to the first coordinate of node <tt class="docutils literal">n1</tt> via marker with number <tt class="docutils literal">nodeMarker</tt>,
which is in fact of type <tt class="docutils literal">MarkerIndex</tt>.</p>
<p>Now we add a spring-damper to the markers with numbers <tt class="docutils literal">groundMarker</tt> and the <tt class="docutils literal">nodeMarker</tt>, providing stiffness and damping parameters:</p>
<pre class="code python literal-block">
<span class="name">nC</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddObject</span><span class="punctuation">(</span><span class="name">CoordinateSpringDamper</span><span class="punctuation">(</span><span class="name">markerNumbers</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">groundMarker</span><span class="punctuation">,</span> <span class="name">nodeMarker</span><span class="punctuation">],</span>
                                     <span class="name">stiffness</span> <span class="operator">=</span> <span class="name">spring</span><span class="punctuation">,</span>
                                     <span class="name">damping</span> <span class="operator">=</span> <span class="name">damper</span><span class="punctuation">))</span>
</pre>
<p>A load is added to marker <tt class="docutils literal">nodeMarker</tt>, with a scalar load with value <tt class="docutils literal">f</tt>:</p>
<pre class="code python literal-block">
<span class="name">nLoad</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddLoad</span><span class="punctuation">(</span><span class="name">LoadCoordinate</span><span class="punctuation">(</span><span class="name">markerNumber</span> <span class="operator">=</span> <span class="name">nodeMarker</span><span class="punctuation">,</span>
                                   <span class="name">load</span> <span class="operator">=</span> <span class="name">f</span><span class="punctuation">))</span>
</pre>
<p>Finally, a sensor is added to the coordinate constraint object with number <tt class="docutils literal">nC</tt>, requesting the <tt class="docutils literal">outputVariableType</tt> <tt class="docutils literal">Force</tt>:</p>
<pre class="code python literal-block">
<span class="name">mbs</span><span class="operator">.</span><span class="name">AddSensor</span><span class="punctuation">(</span><span class="name">SensorObject</span><span class="punctuation">(</span><span class="name">objectNumber</span><span class="operator">=</span><span class="name">nC</span><span class="punctuation">,</span> <span class="name">fileName</span><span class="operator">=</span><span class="literal string single">'groundForce.txt'</span><span class="punctuation">,</span>
                           <span class="name">outputVariableType</span><span class="operator">=</span><span class="name">exu</span><span class="operator">.</span><span class="name">OutputVariableType</span><span class="operator">.</span><span class="name">Force</span><span class="punctuation">))</span>
</pre>
<p>Note that sensors can be attached, e.g., to nodes, bodies, objects (constraints) or loads.
As our system is fully set, we can print the overall information and assemble the system to make it ready for simulation:</p>
<pre class="code python literal-block">
<span class="name builtin">print</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">)</span>
<span class="name">mbs</span><span class="operator">.</span><span class="name">Assemble</span><span class="punctuation">()</span>
</pre>
<p>We will use time integration and therefore define a number of steps (fixed step size; must be provided) and the total time span for the simulation:</p>
<pre class="code python literal-block">
<span class="name">tEnd</span> <span class="operator">=</span> <span class="literal number integer">1</span>     <span class="comment single">#end time of simulation</span>
<span class="name">h</span> <span class="operator">=</span> <span class="literal number float">0.001</span>    <span class="comment single">#step size; leads to 1000 steps</span>
</pre>
<p>All settings for simulation, see according reference section, can be provided in a structure given from <tt class="docutils literal">exu.SimulationSettings()</tt>. Note that this structure will contain all default values, and only non-default values need to be provided:</p>
<pre class="code python literal-block">
<span class="name">simulationSettings</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">SimulationSettings</span><span class="punctuation">()</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">solutionWritePeriod</span> <span class="operator">=</span> <span class="literal number float">5e-3</span> <span class="comment single">#output interval general</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">sensorsWritePeriod</span> <span class="operator">=</span> <span class="literal number float">5e-3</span>  <span class="comment single">#output interval of sensors</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">numberOfSteps</span> <span class="operator">=</span> <span class="name builtin">int</span><span class="punctuation">(</span><span class="name">tEnd</span><span class="operator">/</span><span class="name">h</span><span class="punctuation">)</span> <span class="comment single">#must be integer</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">endTime</span> <span class="operator">=</span> <span class="name">tEnd</span>
</pre>
<p>We are using a generalized alpha solver, where numerical damping is needed for index 3 constraints. As we have only spring-dampers, we can set the spectral radius to 1, meaning no numerical damping:</p>
<pre class="code python literal-block">
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">generalizedAlpha</span><span class="operator">.</span><span class="name">spectralRadius</span> <span class="operator">=</span> <span class="literal number integer">1</span>
</pre>
<p>In order to visualize the results online, a renderer can be started. As our computation will be very fast, it is a good idea to wait for the user to press SPACE, before starting the simulation (uncomment second line):</p>
<pre class="code python literal-block">
<span class="name">exu</span><span class="operator">.</span><span class="name">StartRenderer</span><span class="punctuation">()</span>              <span class="comment single">#start graphics visualization</span>
<span class="comment single">#mbs.WaitForUserToContinue()     #wait for pressing SPACE bar to continue (in render window!)</span>
</pre>
<p>As the simulation is still very fast, we will not see the motion of our node. Using e.g. <tt class="docutils literal">steps=10000000</tt> in the lines above allows you online visualize the resulting oscillations.</p>
<p>Finally, we start the solver, by telling which system to be solved, solver type and the simulation settings:</p>
<pre class="code python literal-block">
<span class="name">exu</span><span class="operator">.</span><span class="name">SolveDynamic</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">simulationSettings</span><span class="punctuation">)</span>
</pre>
<p>After simulation, our renderer needs to be stopped (otherwise it would stay in background and prohibit further simulations).
Sometimes you would like to wait until closing the render window, using <tt class="docutils literal">WaitForRenderEngineStopFlag()</tt>:</p>
<pre class="code python literal-block">
<span class="comment single">#SC.WaitForRenderEngineStopFlag()#wait for pressing 'Q' to quit</span>
<span class="name">exu</span><span class="operator">.</span><span class="name">StopRenderer</span><span class="punctuation">()</span>               <span class="comment single">#safely close rendering window!</span>
</pre>
<p>There are several ways to evaluate results, see the reference pages. In the following we take the final value of node <tt class="docutils literal">n1</tt> and read its 3D position vector:</p>
<pre class="code python literal-block">
<span class="comment single">#evaluate final (=current) output values</span>
<span class="name">u</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">GetNodeOutput</span><span class="punctuation">(</span><span class="name">n1</span><span class="punctuation">,</span> <span class="name">exu</span><span class="operator">.</span><span class="name">OutputVariableType</span><span class="operator">.</span><span class="name">Position</span><span class="punctuation">)</span>
<span class="name builtin">print</span><span class="punctuation">(</span><span class="literal string single">'displacement='</span><span class="punctuation">,</span><span class="name">u</span><span class="punctuation">)</span>
</pre>
<p>The following code generates a reference (exact) solution for our example:</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">matplotlib.pyplot</span> <span class="keyword">as</span> <span class="name namespace">plt</span>
<span class="keyword namespace">import</span> <span class="name namespace">matplotlib.ticker</span> <span class="keyword">as</span> <span class="name namespace">ticker</span>

<span class="name">omega0</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">sqrt</span><span class="punctuation">(</span><span class="name">spring</span><span class="operator">/</span><span class="name">mass</span><span class="punctuation">)</span>          <span class="comment single">#eigen frequency of undamped system</span>
<span class="name">dRel</span> <span class="operator">=</span> <span class="name">damper</span><span class="operator">/</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="operator">*</span><span class="name">np</span><span class="operator">.</span><span class="name">sqrt</span><span class="punctuation">(</span><span class="name">spring</span><span class="operator">*</span><span class="name">mass</span><span class="punctuation">))</span> <span class="comment single">#dimensionless damping</span>
<span class="name">omega</span> <span class="operator">=</span> <span class="name">omega0</span><span class="operator">*</span><span class="name">np</span><span class="operator">.</span><span class="name">sqrt</span><span class="punctuation">(</span><span class="literal number integer">1</span><span class="operator">-</span><span class="name">dRel</span><span class="operator">**</span><span class="literal number integer">2</span><span class="punctuation">)</span>      <span class="comment single">#eigen freq of damped system</span>
<span class="name">C1</span> <span class="operator">=</span> <span class="name">u0</span><span class="operator">-</span><span class="name">x0</span> <span class="comment single">#static solution needs to be considered!</span>
<span class="name">C2</span> <span class="operator">=</span> <span class="punctuation">(</span><span class="name">v0</span><span class="operator">+</span><span class="name">omega0</span><span class="operator">*</span><span class="name">dRel</span><span class="operator">*</span><span class="name">C1</span><span class="punctuation">)</span> <span class="operator">/</span> <span class="name">omega</span>       <span class="comment single">#C1, C2 are coeffs for solution</span>
<span class="name">steps</span> <span class="operator">=</span> <span class="name builtin">int</span><span class="punctuation">(</span><span class="name">tEnd</span><span class="operator">/</span><span class="name">h</span><span class="punctuation">)</span>                    <span class="comment single">#use same steps for reference solution</span>

<span class="name">refSol</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">zeros</span><span class="punctuation">((</span><span class="name">steps</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">2</span><span class="punctuation">))</span>
<span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="name">steps</span><span class="operator">+</span><span class="literal number integer">1</span><span class="punctuation">):</span>
  <span class="name">t</span> <span class="operator">=</span> <span class="name">tEnd</span><span class="operator">*</span><span class="name">i</span><span class="operator">/</span><span class="name">steps</span>
  <span class="name">refSol</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">t</span>
  <span class="name">refSol</span><span class="punctuation">[</span><span class="name">i</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">exp</span><span class="punctuation">(</span><span class="operator">-</span><span class="name">omega0</span><span class="operator">*</span><span class="name">dRel</span><span class="operator">*</span><span class="name">t</span><span class="punctuation">)</span><span class="operator">*</span><span class="punctuation">(</span><span class="name">C1</span><span class="operator">*</span><span class="name">np</span><span class="operator">.</span><span class="name">cos</span><span class="punctuation">(</span><span class="name">omega</span><span class="operator">*</span><span class="name">t</span><span class="punctuation">)</span><span class="operator">+</span><span class="name">C2</span><span class="operator">*</span><span class="name">np</span><span class="operator">.</span><span class="name">sin</span><span class="punctuation">(</span><span class="name">omega</span><span class="operator">*</span><span class="name">t</span><span class="punctuation">))</span><span class="operator">+</span><span class="name">x0</span>

<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">refSol</span><span class="punctuation">[:,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">refSol</span><span class="punctuation">[:,</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="literal string single">'r-'</span><span class="punctuation">,</span> <span class="name">label</span><span class="operator">=</span><span class="literal string single">'displacement (m); exact solution'</span><span class="punctuation">)</span>
</pre>
<p>Now we can load our results from the default solution file <tt class="docutils literal">coordinatesSolution.txt</tt>, which is in the same
directory as your python tutorial file.
<strong>Note</strong> that the visualization of results can be simplified considerably using the <tt class="docutils literal"><span class="pre">PlotSensor(...)</span></tt> utility function as shown in the <strong>Rigid body and joints tutorial</strong>!</p>
<p>For reading the file containing commented lines (this does not work in binary mode!), we use a numpy feature and finally plot the displacement of coordinate 0 or our mass point (<tt class="docutils literal"><span class="pre">data[:,0]</span></tt> contains the simulation time, <tt class="docutils literal"><span class="pre">data[:,1]</span></tt> contains displacement of (global) coordinate 0, <tt class="docutils literal"><span class="pre">data[:,2]</span></tt> contains displacement of (global) coordinate 1, ...)):</p>
<pre class="code python literal-block">
<span class="name">data</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">loadtxt</span><span class="punctuation">(</span><span class="literal string single">'coordinatesSolution.txt'</span><span class="punctuation">,</span> <span class="name">comments</span><span class="operator">=</span><span class="literal string single">'#'</span><span class="punctuation">,</span> <span class="name">delimiter</span><span class="operator">=</span><span class="literal string single">','</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">data</span><span class="punctuation">[:,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">data</span><span class="punctuation">[:,</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="literal string single">'b-'</span><span class="punctuation">,</span> <span class="name">label</span><span class="operator">=</span><span class="literal string single">'displacement (m); numerical solution'</span><span class="punctuation">)</span>
</pre>
<p>The sensor result can be loaded in the same way. The sensor output format contains time in the first column and sensor values in the remaining columns. The number of columns depends on the
sensor and the output quantity (scalar, vector, ...):</p>
<pre class="code python literal-block">
<span class="name">data</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">loadtxt</span><span class="punctuation">(</span><span class="literal string single">'groundForce.txt'</span><span class="punctuation">,</span> <span class="name">comments</span><span class="operator">=</span><span class="literal string single">'#'</span><span class="punctuation">,</span> <span class="name">delimiter</span><span class="operator">=</span><span class="literal string single">','</span><span class="punctuation">)</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">plot</span><span class="punctuation">(</span><span class="name">data</span><span class="punctuation">[:,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">data</span><span class="punctuation">[:,</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">*</span><span class="literal number float">1e-3</span><span class="punctuation">,</span> <span class="literal string single">'g-'</span><span class="punctuation">,</span> <span class="name">label</span><span class="operator">=</span><span class="literal string single">'force (kN)'</span><span class="punctuation">)</span>
</pre>
<p>In order to get a nice plot within Spyder, the following options can be used (note, in some environments you need finally the command <tt class="docutils literal">plt.show()</tt>):</p>
<pre class="code python literal-block">
<span class="name">ax</span><span class="operator">=</span><span class="name">plt</span><span class="operator">.</span><span class="name">gca</span><span class="punctuation">()</span> <span class="comment single"># get current axes</span>
<span class="name">ax</span><span class="operator">.</span><span class="name">grid</span><span class="punctuation">(</span><span class="keyword constant">True</span><span class="punctuation">,</span> <span class="literal string single">'major'</span><span class="punctuation">,</span> <span class="literal string single">'both'</span><span class="punctuation">)</span>
<span class="name">ax</span><span class="operator">.</span><span class="name">xaxis</span><span class="operator">.</span><span class="name">set_major_locator</span><span class="punctuation">(</span><span class="name">ticker</span><span class="operator">.</span><span class="name">MaxNLocator</span><span class="punctuation">(</span><span class="literal number integer">10</span><span class="punctuation">))</span>
<span class="name">ax</span><span class="operator">.</span><span class="name">yaxis</span><span class="operator">.</span><span class="name">set_major_locator</span><span class="punctuation">(</span><span class="name">ticker</span><span class="operator">.</span><span class="name">MaxNLocator</span><span class="punctuation">(</span><span class="literal number integer">10</span><span class="punctuation">))</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">legend</span><span class="punctuation">()</span> <span class="comment single">#show labels as legend</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">tight_layout</span><span class="punctuation">()</span>
<span class="name">plt</span><span class="operator">.</span><span class="name">show</span><span class="punctuation">()</span>
</pre>
<p>The matplotlib output should look like this:</p>
<img alt="docs/theDoc/figures/plotSpringDamper.png" src="docs/theDoc/figures/plotSpringDamper.png" style="width: 400px;" />
</div>
<div class="section" id="rigid-body-and-joints-tutorial">
<h2>Rigid body and joints tutorial</h2>
<p>The python source code of the first tutorial can be found in the file:</p>
<blockquote>
<tt class="docutils literal">main/pythonDev/Examples/rigidBodyTutorial3.py</tt></blockquote>
<p>This tutorial will set up a multibody system containing a ground, two rigid bodies and two revolute joints driven by gravity, compare a 3D view of the example in  the figure above.</p>
<img alt="docs/theDoc/figures/TutorialRigidBody1desc.png" src="docs/theDoc/figures/TutorialRigidBody1desc.png" style="width: 400px;" />
<p>We first import the exudyn library and the interface for all nodes, objects, markers, loads and sensors:</p>
<pre class="code python literal-block">
<span class="keyword namespace">import</span> <span class="name namespace">exudyn</span> <span class="keyword">as</span> <span class="name namespace">exu</span>
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.itemInterface</span> <span class="keyword namespace">import</span> <span class="operator">*</span>
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.utilities</span> <span class="keyword namespace">import</span> <span class="operator">*</span>
<span class="keyword namespace">import</span> <span class="name namespace">numpy</span> <span class="keyword">as</span> <span class="name namespace">np</span> <span class="comment single">#for postprocessing</span>
</pre>
<p>The submodule <tt class="docutils literal">exudyn.utilities</tt> contains helper functions for graphics representation, 3D rigid bodies and joints.</p>
<p>As in the first tutorial, we need a <tt class="docutils literal">SystemContainer</tt> and add a new MainSystem <tt class="docutils literal">mbs</tt>:</p>
<pre class="code python literal-block">
<span class="name">SC</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">SystemContainer</span><span class="punctuation">()</span>
<span class="name">mbs</span> <span class="operator">=</span> <span class="name">SC</span><span class="operator">.</span><span class="name">AddSystem</span><span class="punctuation">()</span>
</pre>
<p>We define some geometrical parameters for lateron use.</p>
<pre class="code python literal-block">
<span class="comment single">#physical parameters</span>
<span class="name">g</span> <span class="operator">=</span>     <span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="operator">-</span><span class="literal number float">9.81</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]</span> <span class="comment single">#gravity</span>
<span class="name">L</span> <span class="operator">=</span> <span class="literal number integer">1</span>               <span class="comment single">#length</span>
<span class="name">w</span> <span class="operator">=</span> <span class="literal number float">0.1</span>             <span class="comment single">#width</span>
<span class="name">bodyDim</span><span class="operator">=</span><span class="punctuation">[</span><span class="name">L</span><span class="punctuation">,</span><span class="name">w</span><span class="punctuation">,</span><span class="name">w</span><span class="punctuation">]</span> <span class="comment single">#body dimensions</span>
<span class="name">p0</span> <span class="operator">=</span>    <span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]</span>     <span class="comment single">#origin of pendulum</span>
<span class="name">pMid0</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">array</span><span class="punctuation">([</span><span class="name">L</span><span class="operator">*</span><span class="literal number float">0.5</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">])</span> <span class="comment single">#center of mass, body0</span>
</pre>
<p>We add an empty ground body, using default values. It's origin is at [0,0,0] and here we use no visualization.</p>
<pre class="code python literal-block">
<span class="comment single">#ground body</span>
<span class="name">oGround</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddObject</span><span class="punctuation">(</span><span class="name">ObjectGround</span><span class="punctuation">())</span>
</pre>
<p>For physical parameters of the rigid body, we can use the class <tt class="docutils literal">RigidBodyInertia</tt>, which allows to define mass, center of mass (COM) and inertia parameters, as well as shifting COM or adding inertias.
The <tt class="docutils literal">RigidBodyInertia</tt> can be used directly to create rigid bodies. Special derived classes can be use to define rigid body inertias for cylinders, cubes, etc., so we use a cube here:</p>
<pre class="code python literal-block">
<span class="comment single">#first link:</span>
<span class="name">iCube0</span> <span class="operator">=</span> <span class="name">InertiaCuboid</span><span class="punctuation">(</span><span class="name">density</span><span class="operator">=</span><span class="literal number integer">5000</span><span class="punctuation">,</span> <span class="name">sideLengths</span><span class="operator">=</span><span class="name">bodyDim</span><span class="punctuation">)</span>
<span class="name">iCube0</span> <span class="operator">=</span> <span class="name">iCube0</span><span class="operator">.</span><span class="name">Translated</span><span class="punctuation">([</span><span class="operator">-</span><span class="literal number float">0.25</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">])</span> <span class="comment single">#transform COM, COM not at reference point!</span>
</pre>
<p>Note that the COM is translated in axial direction, while it would be at the body's local position [0,0,0] by default!</p>
<p>For visualization, we need to add some graphics for the body defined as a 3D RigidLink object and we additionally draw a basis (three RGB-vectors) at the COM:</p>
<pre class="code python literal-block">
<span class="comment single">#graphics for body</span>
<span class="name">graphicsBody0</span> <span class="operator">=</span> <span class="name">GraphicsDataRigidLink</span><span class="punctuation">(</span><span class="name">p0</span><span class="operator">=</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span><span class="name">p1</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                                     <span class="name">axis0</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">axis1</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">radius</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">,</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">],</span>
                                     <span class="name">thickness</span><span class="operator">=</span><span class="name">w</span><span class="punctuation">,</span> <span class="name">width</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number float">1.2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">,</span><span class="literal number float">1.2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">],</span> <span class="name">color</span><span class="operator">=</span><span class="name">color4red</span><span class="punctuation">)</span>
<span class="name">graphicsCOM0</span> <span class="operator">=</span> <span class="name">GraphicsDataBasis</span><span class="punctuation">(</span><span class="name">origin</span><span class="operator">=</span><span class="name">iCube0</span><span class="operator">.</span><span class="name">com</span><span class="punctuation">,</span> <span class="name">length</span><span class="operator">=</span><span class="literal number integer">2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">)</span>
</pre>
<p>Now we have defined all data for the link (rigid body). We could use <tt class="docutils literal"><span class="pre">mbs.AddNode(NodeRigidBodyEP(...))</span></tt> and <tt class="docutils literal"><span class="pre">mbs.AddObject(ObjectRigidBody(...))</span></tt> to create a node and a body, but the <tt class="docutils literal">exudyn.rigidBodyUtilities</tt> offer a much more comfortable function:</p>
<pre class="code python literal-block">
<span class="punctuation">[</span><span class="name">n0</span><span class="punctuation">,</span><span class="name">b0</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">AddRigidBody</span><span class="punctuation">(</span><span class="name">mainSys</span> <span class="operator">=</span> <span class="name">mbs</span><span class="punctuation">,</span>
                     <span class="name">inertia</span> <span class="operator">=</span> <span class="name">iCube0</span><span class="punctuation">,</span> <span class="comment single">#includes COM</span>
                     <span class="name">nodeType</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">NodeType</span><span class="operator">.</span><span class="name">RotationEulerParameters</span><span class="punctuation">,</span>
                     <span class="name">position</span> <span class="operator">=</span> <span class="name">pMid0</span><span class="punctuation">,</span>
                     <span class="name">rotationMatrix</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">diag</span><span class="punctuation">([</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">]),</span>
                     <span class="name">gravity</span> <span class="operator">=</span> <span class="name">g</span><span class="punctuation">,</span>
                     <span class="name">graphicsDataList</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">graphicsBody0</span><span class="punctuation">,</span> <span class="name">graphicsCOM0</span><span class="punctuation">])</span>
</pre>
<p>which also adds a gravity load and could also set initial velocities, if wanted.
The <tt class="docutils literal">nodeType</tt> specifies the underlying model for the rigid body node, see theDoc.pdf.
We can use</p>
<ul class="simple">
<li><tt class="docutils literal">RotationEulerParameters</tt>: for fast computation, but leads to an additional algebraic equation and thus needs an implicit solver</li>
<li><tt class="docutils literal">RotationRxyz</tt>: contains a singularity if the second angle reaches +/- 90 degrees, but no algebraic equations</li>
<li><tt class="docutils literal">RotationRotationVector</tt>: basically contains a singularity for 0 degrees, but if used in combination with Lie group integrators, singularities are bypassed</li>
</ul>
<p>We now add a revolute joint around the (global) z-axis.
We have several possibilities, which are shown in the following.
For the <strong>first two possibilities only</strong>, we need the following markers</p>
<pre class="code python literal-block">
<span class="comment single">#markers for ground and rigid body (not needed for option 3):</span>
<span class="name">markerGround</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddMarker</span><span class="punctuation">(</span><span class="name">MarkerBodyRigid</span><span class="punctuation">(</span><span class="name">bodyNumber</span><span class="operator">=</span><span class="name">oGround</span><span class="punctuation">,</span> <span class="name">localPosition</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]))</span>
<span class="name">markerBody0J0</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddMarker</span><span class="punctuation">(</span><span class="name">MarkerBodyRigid</span><span class="punctuation">(</span><span class="name">bodyNumber</span><span class="operator">=</span><span class="name">b0</span><span class="punctuation">,</span> <span class="name">localPosition</span><span class="operator">=</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]))</span>
</pre>
<p>The very general option 1 is to use the <tt class="docutils literal">GenericJoint</tt>, that can be used to define any kind of joint with translations and rotations fixed or free,</p>
<pre class="code python literal-block">
<span class="comment single">#revolute joint option 1:</span>
<span class="name">mbs</span><span class="operator">.</span><span class="name">AddObject</span><span class="punctuation">(</span><span class="name">GenericJoint</span><span class="punctuation">(</span><span class="name">markerNumbers</span><span class="operator">=</span><span class="punctuation">[</span><span class="name">markerGround</span><span class="punctuation">,</span> <span class="name">markerBody0J0</span><span class="punctuation">],</span>
                           <span class="name">constrainedAxes</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                           <span class="name">visualization</span><span class="operator">=</span><span class="name">VObjectJointGeneric</span><span class="punctuation">(</span><span class="name">axesRadius</span><span class="operator">=</span><span class="literal number float">0.2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">,</span>
                                                             <span class="name">axesLength</span><span class="operator">=</span><span class="literal number float">1.4</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">)))</span>
</pre>
<p>In addition, transformation matrices (<tt class="docutils literal">rotationMarker0/1</tt>) can be added, see the joint description.</p>
<p>Option 2 is using the revolute joint, which allows a free rotation around the local z-axis of marker 0 (<tt class="docutils literal">markerGround</tt> in our example)</p>
<pre class="code python literal-block">
<span class="comment single">#revolute joint option 2:</span>
<span class="name">mbs</span><span class="operator">.</span><span class="name">AddObject</span><span class="punctuation">(</span><span class="name">ObjectJointRevoluteZ</span><span class="punctuation">(</span><span class="name">markerNumbers</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">markerGround</span><span class="punctuation">,</span> <span class="name">markerBody0J0</span><span class="punctuation">],</span>
                                   <span class="name">rotationMarker0</span><span class="operator">=</span><span class="name">np</span><span class="operator">.</span><span class="name">eye</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">),</span>
                                   <span class="name">rotationMarker1</span><span class="operator">=</span><span class="name">np</span><span class="operator">.</span><span class="name">eye</span><span class="punctuation">(</span><span class="literal number integer">3</span><span class="punctuation">),</span>
                                   <span class="name">visualization</span><span class="operator">=</span><span class="name">VObjectJointRevoluteZ</span><span class="punctuation">(</span><span class="name">axisRadius</span><span class="operator">=</span><span class="literal number float">0.2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">,</span>
                                                                       <span class="name">axisLength</span><span class="operator">=</span><span class="literal number float">1.4</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">)</span>
                                   <span class="punctuation">))</span>
</pre>
<p>Additional transformation matrices (<tt class="docutils literal">rotationMarker0/1</tt>) can be added in order to chose any rotation axis.</p>
<p>Note that an error in the definition of markers for the joints can be also detected in the render window (if you completed the example), e.g., if you change the following marker in the lines above,</p>
<pre class="code python literal-block">
<span class="comment single">#example if wrong marker position is chosen:</span>
<span class="name">markerBody0J0</span> <span class="operator">=</span> <span class="name">mbs</span><span class="operator">.</span><span class="name">AddMarker</span><span class="punctuation">(</span><span class="name">MarkerBodyRigid</span><span class="punctuation">(</span><span class="name">bodyNumber</span><span class="operator">=</span><span class="name">b0</span><span class="punctuation">,</span> <span class="name">localPosition</span><span class="operator">=</span><span class="punctuation">[</span><span class="operator">-</span><span class="literal number float">0.4</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">]))</span>
</pre>
<p>=&gt; you will see a misalignment of the two parts of the joint by <tt class="docutils literal">0.1*L</tt>.</p>
<p>Due to the fact that the definition of markers for general joints is tedious, there is a utility function, which allows to attach revolute joints immediately to bodies and defining the rotation axis only once for the joint:</p>
<pre class="code python literal-block">
<span class="comment single">#revolute joint option 3:</span>
<span class="name">AddRevoluteJoint</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">body0</span><span class="operator">=</span><span class="name">oGround</span><span class="punctuation">,</span> <span class="name">body1</span><span class="operator">=</span><span class="name">b0</span><span class="punctuation">,</span> <span class="name">point</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                 <span class="name">axis</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">],</span> <span class="name">useGlobalFrame</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">,</span> <span class="name">showJoint</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">,</span>
                 <span class="name">axisRadius</span><span class="operator">=</span><span class="literal number float">0.2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">,</span> <span class="name">axisLength</span><span class="operator">=</span><span class="literal number float">1.4</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">)</span>
</pre>
<p>The second link and the according joint can be set up in a very similar way:</p>
<pre class="code python literal-block">
<span class="comment single">#second link:</span>
<span class="name">graphicsBody1</span> <span class="operator">=</span> <span class="name">GraphicsDataRigidLink</span><span class="punctuation">(</span><span class="name">p0</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="operator">-</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">],</span><span class="name">p1</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">],</span>
                                      <span class="name">axis0</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">axis1</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">radius</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number float">0.06</span><span class="punctuation">,</span><span class="literal number float">0.05</span><span class="punctuation">],</span>
                                      <span class="name">thickness</span> <span class="operator">=</span> <span class="literal number float">0.1</span><span class="punctuation">,</span> <span class="name">width</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="literal number float">0.12</span><span class="punctuation">,</span><span class="literal number float">0.12</span><span class="punctuation">],</span>
                                      <span class="name">color</span><span class="operator">=</span><span class="name">color4lightgreen</span><span class="punctuation">)</span>

<span class="name">iCube1</span> <span class="operator">=</span> <span class="name">InertiaCuboid</span><span class="punctuation">(</span><span class="name">density</span><span class="operator">=</span><span class="literal number integer">5000</span><span class="punctuation">,</span> <span class="name">sideLengths</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number float">0.1</span><span class="punctuation">,</span><span class="literal number float">0.1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">])</span>

<span class="name">pMid1</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">array</span><span class="punctuation">([</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">])</span> <span class="operator">+</span> <span class="name">np</span><span class="operator">.</span><span class="name">array</span><span class="punctuation">([</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">])</span> <span class="comment single">#center of mass, body1</span>
<span class="punctuation">[</span><span class="name">n1</span><span class="punctuation">,</span><span class="name">b1</span><span class="punctuation">]</span><span class="operator">=</span><span class="name">AddRigidBody</span><span class="punctuation">(</span><span class="name">mainSys</span> <span class="operator">=</span> <span class="name">mbs</span><span class="punctuation">,</span>
                     <span class="name">inertia</span> <span class="operator">=</span> <span class="name">iCube1</span><span class="punctuation">,</span>
                     <span class="name">nodeType</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">NodeType</span><span class="operator">.</span><span class="name">RotationEulerParameters</span><span class="punctuation">,</span>
                     <span class="name">position</span> <span class="operator">=</span> <span class="name">pMid1</span><span class="punctuation">,</span>
                     <span class="name">rotationMatrix</span> <span class="operator">=</span> <span class="name">np</span><span class="operator">.</span><span class="name">diag</span><span class="punctuation">([</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">1</span><span class="punctuation">]),</span>
                     <span class="name">angularVelocity</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                     <span class="name">gravity</span> <span class="operator">=</span> <span class="name">g</span><span class="punctuation">,</span>
                     <span class="name">graphicsDataList</span> <span class="operator">=</span> <span class="punctuation">[</span><span class="name">graphicsBody1</span><span class="punctuation">])</span>
</pre>
<p>The revolute joint in this case has a free rotation around the global x-axis:</p>
<pre class="code python literal-block">
<span class="comment single">#revolute joint (free x-axis)</span>
<span class="name">AddRevoluteJoint</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">body0</span><span class="operator">=</span><span class="name">b0</span><span class="punctuation">,</span> <span class="name">body1</span><span class="operator">=</span><span class="name">b1</span><span class="punctuation">,</span> <span class="name">point</span><span class="operator">=</span><span class="punctuation">[</span><span class="name">L</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span>
                 <span class="name">axis</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">],</span> <span class="name">useGlobalFrame</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">,</span> <span class="name">showJoint</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">,</span>
                 <span class="name">axisRadius</span><span class="operator">=</span><span class="literal number float">0.2</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">,</span> <span class="name">axisLength</span><span class="operator">=</span><span class="literal number float">1.4</span><span class="operator">*</span><span class="name">w</span><span class="punctuation">)</span>
</pre>
<p>Finally, we also add a sensor for some output of the double pendulum:</p>
<pre class="code python literal-block">
<span class="comment single">#position sensor at tip of body1</span>
<span class="name">sens1</span><span class="operator">=</span><span class="name">mbs</span><span class="operator">.</span><span class="name">AddSensor</span><span class="punctuation">(</span><span class="name">SensorBody</span><span class="punctuation">(</span><span class="name">bodyNumber</span><span class="operator">=</span><span class="name">b1</span><span class="punctuation">,</span> <span class="name">localPosition</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number integer">0</span><span class="punctuation">,</span><span class="literal number float">0.5</span><span class="operator">*</span><span class="name">L</span><span class="punctuation">],</span>
                               <span class="name">fileName</span><span class="operator">=</span><span class="literal string single">'solution/sensorPos.txt'</span><span class="punctuation">,</span>
                               <span class="name">outputVariableType</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">OutputVariableType</span><span class="operator">.</span><span class="name">Position</span><span class="punctuation">))</span>
</pre>
<p>Before simulation, we need to call <tt class="docutils literal">Assemble()</tt> for our system, which links objects, nodes, ..., assigns initial values and does further pre-computations and checks:</p>
<pre class="code python literal-block">
<span class="name">mbs</span><span class="operator">.</span><span class="name">Assemble</span><span class="punctuation">()</span>
</pre>
<p>After <tt class="docutils literal">Assemble()</tt>, markers, nodes, objects, etc. are linked and we can analyze the internal structure. First, we can print out useful information, either just typing <tt class="docutils literal">mbs</tt> in the iPython console to print out overal information:</p>
<pre class="code literal-block">
&lt;systemData:
  Number of nodes= 2
  Number of objects = 5
  Number of markers = 8
  Number of loads = 2
  Number of sensors = 1
  Number of ODE2 coordinates = 14
  Number of ODE1 coordinates = 0
  Number of AE coordinates   = 12
  Number of data coordinates   = 0

For details see mbs.systemData, mbs.sys and mbs.variables
&gt;
</pre>
<p>Note that there are 2 nodes for the two rigid bodies. The five objects are due to ground object, 2 rigid bodies and 2 revolute joints.
The meaning of markers can be seen in the graphical representation described below.</p>
<p>Alternatively we can print the full internal information as a dictionary using:</p>
<pre class="code python literal-block">
<span class="name">mbs</span><span class="operator">.</span><span class="name">systemData</span><span class="operator">.</span><span class="name">Info</span><span class="punctuation">()</span> <span class="comment single">#show detailed information</span>
</pre>
<p>which results in the following output (shortened):</p>
<pre class="code literal-block">
node0:
    'nodeType': 'RigidBodyEP', 'referenceCoordinates': [0.5, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0], 'addConstraintEquation': True, 'initialCoordinates': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 'initialVelocities': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 'name': 'node0', 'Vshow': True, 'VdrawSize': -1.0, 'Vcolor': [-1.0, -1.0, -1.0, -1.0]
node1:
    'nodeType': 'RigidBodyEP', 'referenceCoordinates': [1.0, 0.0, 0.5, 1.0, 0.0, 0.0, 0.0], 'addConstraintEquation': True, 'initialCoordinates': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 'initialVelocities': [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], 'name': 'node1', 'Vshow': True, 'VdrawSize': -1.0, 'Vcolor': [-1.0, -1.0, -1.0, -1.0]
object0:
    'objectType': 'Ground', 'referencePosition': [0.0, 0.0, 0.0], 'name': 'object0', 'Vshow': True, 'VgraphicsDataUserFunction': 0, 'Vcolor': [-1.0, -1.0, -1.0, -1.0], 'VgraphicsData': 'TODO': 'Get graphics data to be implemented'
object1:
    'objectType': 'RigidBody', 'physicsMass': 50.0, 'physicsInertia': [0.08333333333333336, 7.333333333333334, 7.333333333333334, 0.0, 0.0, 0.0], 'physicsCenterOfMass': [-0.25, 0.0, 0.0], 'nodeNumber': 0, 'name': 'object1', 'Vshow': True, 'VgraphicsDataUserFunction': 0, 'VgraphicsData': 'TODO': 'Get graphics data to be implemented'
object2:
    'objectType': 'JointRevolute', 'markerNumbers': [3, 4], 'rotationMarker0': [[0.0, 1.0, 0.0], [-1.0, 0.0, 0.0], [0.0, 0.0, 1.0]], 'rotationMarker1': [[0.0, 1.0, 0.0], [-1.0, 0.0, 0.0], [0.0, 0.0, 1.0]], 'activeConnector': True, 'name': 'object2', 'Vshow': True, 'VaxisRadius': 0.019999999552965164, 'VaxisLength': 0.14000000059604645, 'Vcolor': [-1.0, -1.0, -1.0, -1.0]
object3:
...
</pre>
<p>A graphical representation of the internal structure of the model can be shown using the command <tt class="docutils literal">DrawSystemGraph</tt>:</p>
<pre class="code python literal-block">
<span class="name">DrawSystemGraph</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">useItemTypes</span><span class="operator">=</span><span class="keyword constant">True</span><span class="punctuation">)</span> <span class="comment single">#draw nice graph of system</span>
</pre>
<p>For the output see the figure below. Note that obviously, markers are always needed to connect objects (or nodes) as well as loads. We can also see, that 2 markers MarkerBodyRigid1 and MarkerBodyRigid2 are unused, which is no further problem for the model and also does not require additional computational resources (except for some bytes of memory). Having isolated nodes or joints that are not connected (or having too many connections) may indicate that you did something wrong in setting up your model.</p>
<img alt="docs/theDoc/figures/DrawSystemGraphExample.png" src="docs/theDoc/figures/DrawSystemGraphExample.png" style="width: 400px;" />
<p>Before starting our simulation, we should adjust the solver parameters, especially the end time and the step size (no automatic step size for implicit solvers available!):</p>
<pre class="code python literal-block">
<span class="name">simulationSettings</span> <span class="operator">=</span> <span class="name">exu</span><span class="operator">.</span><span class="name">SimulationSettings</span><span class="punctuation">()</span> <span class="comment single">#takes currently set values or default values</span>

<span class="name">tEnd</span> <span class="operator">=</span> <span class="literal number integer">4</span> <span class="comment single">#simulation time</span>
<span class="name">h</span> <span class="operator">=</span> <span class="literal number float">1e-3</span> <span class="comment single">#step size</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">numberOfSteps</span> <span class="operator">=</span> <span class="name builtin">int</span><span class="punctuation">(</span><span class="name">tEnd</span><span class="operator">/</span><span class="name">h</span><span class="punctuation">)</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">endTime</span> <span class="operator">=</span> <span class="name">tEnd</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">timeIntegration</span><span class="operator">.</span><span class="name">verboseMode</span> <span class="operator">=</span> <span class="literal number integer">1</span>
<span class="comment single">#simulationSettings.timeIntegration.simulateInRealtime = True</span>
<span class="name">simulationSettings</span><span class="operator">.</span><span class="name">solutionSettings</span><span class="operator">.</span><span class="name">solutionWritePeriod</span> <span class="operator">=</span> <span class="literal number float">0.005</span> <span class="comment single">#store every 5 ms</span>
</pre>
<p>The <tt class="docutils literal">verboseMode</tt> tells the solver the amount of output during solving. Higher values (2, 3, ...) show residual vectors, jacobians, etc. for every time step, but slow down simulation significantly.
The option <tt class="docutils literal">simulateInRealtime</tt> is used to view the model during simulation, while setting this false, the simulation finishes after fractions of a second. It should be set to false in general, while solution can be viewed using the <tt class="docutils literal">SolutionViewer()</tt>.
With <tt class="docutils literal">solutionWritePeriod</tt> you can adjust the frequency which is used to store the solution of the whole model, which may lead to very large files and may slow down simulation, but is used in the <tt class="docutils literal">SolutionViewer()</tt> to reload the solution after simulation.</p>
<p>In order to improve visualization, there are hundreds of options, see Visualization settings in theDoc.pdf, some of them used here:</p>
<pre class="code python literal-block">
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">window</span><span class="operator">.</span><span class="name">renderWindowSize</span><span class="operator">=</span><span class="punctuation">[</span><span class="literal number integer">1600</span><span class="punctuation">,</span><span class="literal number integer">1200</span><span class="punctuation">]</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">openGL</span><span class="operator">.</span><span class="name">multiSampling</span> <span class="operator">=</span> <span class="literal number integer">4</span>  <span class="comment single">#improved OpenGL rendering</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">general</span><span class="operator">.</span><span class="name">autoFitScene</span> <span class="operator">=</span> <span class="keyword constant">False</span>

<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">nodes</span><span class="operator">.</span><span class="name">drawNodesAsPoint</span><span class="operator">=</span><span class="keyword constant">False</span>
<span class="name">SC</span><span class="operator">.</span><span class="name">visualizationSettings</span><span class="operator">.</span><span class="name">nodes</span><span class="operator">.</span><span class="name">showBasis</span><span class="operator">=</span><span class="keyword constant">True</span> <span class="comment single">#shows three RGB (=xyz) lines for node basis</span>
</pre>
<p>The option <tt class="docutils literal">autoFitScene</tt> is used in order to avoid zooming while loading the last saved render state, see below.</p>
<p>We can start the 3D visualization (Renderer) now:</p>
<pre class="code python literal-block">
<span class="name">exu</span><span class="operator">.</span><span class="name">StartRenderer</span><span class="punctuation">()</span>
</pre>
<p>In order to reload the model view of the last simulation (if there is any), we can use the following commands:</p>
<pre class="code python literal-block">
<span class="keyword">if</span> <span class="literal string single">'renderState'</span> <span class="operator word">in</span> <span class="name">exu</span><span class="operator">.</span><span class="name">sys</span><span class="punctuation">:</span> <span class="comment single">#reload old view</span>
    <span class="name">SC</span><span class="operator">.</span><span class="name">SetRenderState</span><span class="punctuation">(</span><span class="name">exu</span><span class="operator">.</span><span class="name">sys</span><span class="punctuation">[</span><span class="literal string single">'renderState'</span><span class="punctuation">])</span>

<span class="name">mbs</span><span class="operator">.</span><span class="name">WaitForUserToContinue</span><span class="punctuation">()</span> <span class="comment single">#stop before simulating</span>
</pre>
<p>the function <tt class="docutils literal">WaitForUserToContinue()</tt> waits with simulation until we press SPACE bar. This allows us to make some pre-checks.</p>
<p>Finally, the <strong>index 2</strong> (velocity level) implicit time integration (simulation) is started with:</p>
<pre class="code python literal-block">
<span class="name">exu</span><span class="operator">.</span><span class="name">SolveDynamic</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">simulationSettings</span> <span class="operator">=</span> <span class="name">simulationSettings</span><span class="punctuation">,</span>
                 <span class="name">solverType</span><span class="operator">=</span><span class="name">exu</span><span class="operator">.</span><span class="name">DynamicSolverType</span><span class="operator">.</span><span class="name">TrapezoidalIndex2</span><span class="punctuation">)</span>
</pre>
<p>This solver is used in the present example, but should be considered with care as it leads to (small) drift of position constraints, linearly increasing in time. Using sufficiently small time steps, this effect is often negligible on the advantage of having a <strong>energy-conserving integrator</strong> (guaranteed for linear systems, but very often also for the nonlinear multibody system). Due to the velocity level, the integrator is less sensitive to consistent initial conditions on position level and compatible to frequent step size changes, however, initial jumps in velocities may never damp out in undamped systems.</p>
<p>Alternatively, an <strong>index 3</strong> implicit time integration -- the generalized-alpha method -- is started with:</p>
<pre class="code python literal-block">
<span class="name">exu</span><span class="operator">.</span><span class="name">SolveDynamic</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">simulationSettings</span> <span class="operator">=</span> <span class="name">simulationSettings</span><span class="punctuation">)</span>
</pre>
<p>Note that the <strong>generalized-alpha method</strong> includes numerical damping (adjusted with the spectral radius) for stabilization of index 3 constraints. This leads to effects every time the integrator is (re-)started, e.g., when adapting time step sizes. For fixed step sizes, this is <strong>the recommended integrator</strong>.</p>
<p>After simulation, the library would immediately exit (and jump back to iPython or close the terminal window). In order to avoid this, we can use <tt class="docutils literal">WaitForRenderEngineStopFlag()</tt> to wait until we press key 'Q'.</p>
<pre class="code python literal-block">
<span class="name">SC</span><span class="operator">.</span><span class="name">WaitForRenderEngineStopFlag</span><span class="punctuation">()</span> <span class="comment single">#stop before closing</span>
<span class="name">exu</span><span class="operator">.</span><span class="name">StopRenderer</span><span class="punctuation">()</span> <span class="comment single">#safely close rendering window!</span>
</pre>
<p>If you entered everything correctly, the render window should show a nice animation of the 3D double pendulum after pressing the SPACE key.
If we do not stop the renderer (<tt class="docutils literal">StopRenderer()</tt>), it will stay open for further simulations. However, it is safer to always close the renderer at the end.</p>
<p>As the simulation will run very fast, if you did not set <tt class="docutils literal">simulateInRealtime</tt> to true. However, you can reload the stored solution and view the stored steps interactively:</p>
<pre class="code python literal-block">
<span class="name">sol</span> <span class="operator">=</span> <span class="name">LoadSolutionFile</span><span class="punctuation">(</span><span class="literal string single">'coordinatesSolution.txt'</span><span class="punctuation">)</span>
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.interactive</span> <span class="keyword namespace">import</span> <span class="name">SolutionViewer</span>
<span class="name">SolutionViewer</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="name">sol</span><span class="punctuation">)</span>
</pre>
<p>Finally, we can plot our sensor, drawing the y-component of the sensor (check out the many options in <tt class="docutils literal"><span class="pre">PlotSensor(...)</span></tt> to conveniently represent results!):</p>
<pre class="code python literal-block">
<span class="keyword namespace">from</span> <span class="name namespace">exudyn.plot</span> <span class="keyword namespace">import</span> <span class="name">PlotSensor</span>
<span class="name">PlotSensor</span><span class="punctuation">(</span><span class="name">mbs</span><span class="punctuation">,</span> <span class="punctuation">[</span><span class="name">sens1</span><span class="punctuation">],[</span><span class="literal number integer">1</span><span class="punctuation">])</span>
</pre>
<p><strong>Congratulations</strong>! You completed the rigid body tutorial, which gives you the ability to model multibody systems. Note that much more complicated models are possible, including feedback control or flexible bodies, see the Examples!</p>
<p><strong>FOR FURTHER INFORMATION GO TO theDoc.pdf !!!</strong></p>
</div>
</div>
</div>
</body>
</html>
